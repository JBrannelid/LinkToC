import{j as e,e as U,M as q,F as X,a as H,B as w,k as G,n as ee,o as se,L as E,P as O,p as P,q as T,U as S,u as te,m as V,r as A,s as le,t as ae,v as re,w as ne}from"./index-BZdNtiSy.js";import{r as p,e as ie}from"./vendor-router-BURTDQSf.js";import{a as ce}from"./vendor-forms-DlkW-UdB.js";import"./JoinStableForm-UJNmKWBV.js";import{H as Y}from"./HandRaisedIcon-CPMQ79lY.js";import{M as oe}from"./MessageIcon-KSfjnB0u.js";import{P as W}from"./PenIcon-B_i2QjdT.js";import"./vendor-react-DavUf6mE.js";import"./FormMessage-HRjzXPh7.js";import"./LocationPinIcon-Bmni9Z2U.js";const Z=({size:s=24,color:r="currentColor",className:n="",strokeWidth:a=1.5,...x})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",className:n,...x,children:e.jsx("path",{fill:r,d:"M16,6l-13,0c-0.552,0 -1,0.448 -1,1l0,22c0,0.552 0.448,1 1,1l22,0c0.552,0 1,-0.448 1,-1l0,-13c0,-0.552 -0.448,-1 -1,-1c-0.552,-0 -1,0.448 -1,1l0,12c0,0 -20,0 -20,0c0,0 0,-20 0,-20c-0,0 12,0 12,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1Zm-9,19l14,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-14,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm-0,-4l4,0c0.552,-0 1,-0.448 1,-1c-0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,-0 -1,0.448 -1,1c-0,0.552 0.448,1 1,1Zm22.707,-13.293c0.391,-0.39 0.391,-1.024 0,-1.414l-4,-4c-0.39,-0.391 -1.024,-0.391 -1.414,-0l-10,10c-0.14,0.139 -0.235,0.317 -0.274,0.511l-1,5c-0.065,0.328 0.037,0.667 0.274,0.903c0.236,0.237 0.575,0.339 0.903,0.274l5,-1c0.194,-0.039 0.372,-0.134 0.511,-0.274l10,-10Zm-22.707,9.293l4,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm0,-4l5,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-5,-0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Z",strokeWidth:a})}),de=({post:s=null,onSubmit:r,onCancel:n,onDelete:a,title:x="New post"})=>{const{currentStable:o,currentUser:d}=U(),c=p.useRef(null),[f,i]=p.useState(!1),l=ce({defaultValues:{title:"",content:""}});p.useEffect(()=>{s?l.reset({title:s.title||"",content:s.content||""}):l.reset({title:"",content:""})},[s,l]);const h=y=>{const C={...y,id:s?.id,userIdFk:s?.userIdFk||d?.id,stableIdFk:s?.stableIdFk||o?.id,date:s?.date||new Date().toISOString(),isPinned:s?.isPinned||!1};r(C)},u=()=>{i(!0)},m=()=>{s&&s.id&&typeof a=="function"&&(a(s.id),i(!1)),n()},j=()=>{c.current&&c.current.click()},b=y=>{y.target.files[0]};return e.jsx("div",{className:"fixed inset-0 z-50 bg-white md:bg-black/40 shadow-md flex flex-col md:items-center md:justify-center",children:e.jsxs("div",{className:"w-full h-full md:h-auto md:w-xl overflow-y-auto bg-background shadow-md rounded flex flex-col relative",children:[e.jsxs("div",{className:"bg-primary-light pb-5",children:[e.jsx(q,{showCloseBtn:!0,onCloseClick:n,className:"bg-primary-light",render:"left"}),e.jsx("h1",{className:"text-center text-xl uppercase mt-5",children:x})]}),e.jsx("div",{className:"flex flex-col flex-1 px-4 pt-4 pb-6 md:pb-4",children:e.jsxs(X,{methods:l,onSubmit:h,footer:{showFooter:!1},className:"flex flex-col flex-1",children:[e.jsx("div",{className:"bg-white rounded-t-lg border-b border-primary-light",children:e.jsx(H,{name:"title",placeholder:"Title...",inputClassName:"h-12 border-none !rounded-b-0 font-semibold",validation:{required:"Title is required",maxLength:{value:100,message:"Maximum 100 characters"}}})}),e.jsx("div",{className:"bg-white rounded-b-lg flex-grow",children:e.jsx(H,{name:"content",type:"textarea",placeholder:"Description...",inputClassName:"border-none !rounded-t-0 h-full",rows:7,validation:{required:"Content is required"},className:"h-full"})}),e.jsxs("div",{className:"mt-4 mb-6 flex justify-end",children:[e.jsx(w,{type:"secondary",className:"w-6/10 h-8 md:w-4/10",onClick:j,children:"Upload image"}),e.jsx("input",{type:"file",ref:c,onChange:b,accept:"image/*",className:"hidden"})]}),e.jsx("div",{className:"w-full flex justify-center mt-auto",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-md",children:[e.jsx(w,{type:"primary",className:"w-full",onClick:l.handleSubmit(h),children:s?"Update":"Post"}),s&&e.jsx(w,{type:"danger",className:"w-full",onClick:u,children:"Delete"})]})})]})}),e.jsx(G,{isOpen:f,onClose:()=>i(!1),onConfirm:m,title:"Delete this post?",confirmButtonText:"Delete",confirmButtonType:"danger",cancelButtonText:"Cancel",icon:e.jsx(Y,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"}),children:e.jsx("p",{className:"text-center",children:"Are you sure you want to delete this post? This action cannot be undone."})})]})})},me=({count:s,onClick:r})=>e.jsx("div",{className:"flex justify-end items-center text-gray mt-2 pb-2 border-b-1 border-primary cursor-pointer hover:text-primary",onClick:r,children:e.jsxs("span",{className:"text-sm",children:[s," comments"]})}),xe=({size:s=24,color:r="currentColor",strokeWidth:n=2,className:a=""})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:e.jsx("path",{d:"M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z",stroke:r,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})}),ue=({onSubmit:s,postId:r,disabled:n=!1})=>{const[a,x]=p.useState(""),{currentUser:o}=U(),d=c=>{c.preventDefault(),a.trim()&&s&&(s(r,a),x(""))};return e.jsxs("form",{onSubmit:d,className:"mt-3 flex",children:[e.jsx(xe,{className:"w-7 h-7 mr-1 text-primary"}),e.jsx("div",{className:"flex-grow bg-light/40 rounded-full",children:e.jsx("input",{type:"text",placeholder:`Comment as ${ee(o)}...`,className:"w-full px-3 py-1 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary",value:a,onChange:c=>x(c.target.value),disabled:n})})]})},he=({isOpen:s,onClose:r,comments:n=[],postId:a,onCreateComment:x,onDeleteComment:o,loading:d})=>{const{currentUser:c,getCurrentStableRole:f}=U(),[i,l]=p.useState(""),[h,u]=p.useState(null),[m,j]=p.useState(!1),b=f(),y=b===S.ADMIN||b===S.MANAGER;if(!s)return null;const C=t=>{t.preventDefault(),i.trim()&&(x(a,i),l(""))},v=()=>{h&&(o(h.id,a),j(!1),u(null))},I=t=>{(y||t.userId===c?.id)&&(u(t),j(!0))},k=t=>{try{const g=P(t);return T(g,"MM/dd-yy HH:mm")}catch{return"Unknown date"}};return e.jsxs("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-30",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-9/10 md:max-w-5/10 h-7/10 flex flex-col relative",children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-2xl font-semibold text-center",children:"Comments"}),e.jsx("button",{onClick:r,className:"absolute top-4 right-4","aria-label":"Close",children:e.jsx(se,{size:30,strokeWidth:2,className:"text-primary "})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 max-h-96",children:d?e.jsxs("div",{className:"flex justify-center items-center h-40",children:[e.jsx(E,{size:"medium"}),e.jsx("p",{className:"ml-2",children:"Loading comments..."})]}):e.jsx("div",{className:"space-y-4",children:n&&n.length>0?n.map((t,g)=>e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:"absolute left-0 top-2",children:e.jsx(O,{user:{id:t.userId,profilePicture:t.profilePicture,firstName:t.firstName||"",lastName:t.lastName||""},className:"w-12 h-12 rounded-full object-cover border border-light",alt:`${t.firstName||"User"} ${t.lastName||""}'s avatar`,size:"rounded"})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-sm text-gray",children:k(t.commentDate)})}),e.jsxs("div",{className:`border border-gray rounded-lg p-4 ${y||t.userId===c?.id?"hover:bg-light/30 cursor-pointer":""}`,onClick:()=>I(t),children:[e.jsx("div",{className:"flex mb-2",children:e.jsxs("p",{className:"font-bold",children:[t.firstName," ",t.lastName]})}),e.jsx("p",{className:"text-black break-words",children:t.content})]})]},g)):e.jsx("p",{className:"text-center py-8 text-gray",children:"No comments yet"})})}),e.jsx("div",{className:"border-t border-light p-4",children:e.jsxs("form",{onSubmit:C,className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Add a comment...",className:"flex-grow px-4 py-3 border border-light rounded-lg focus:outline-none focus:ring-1 focus:ring-primary",value:i,onChange:t=>l(t.target.value)}),e.jsxs(w,{type:"primary",htmlType:"submit",className:"rounded-lg px-6 py-3",disabled:d||!i.trim(),children:[e.jsx("span",{className:"block md:hidden",children:"+"}),e.jsx("span",{className:"hidden md:block",children:"Comment"})]})]})})]}),e.jsx(G,{isOpen:m,onClose:()=>j(!1),onConfirm:v,title:"Delete Comment",confirmButtonText:"Delete",confirmButtonType:"danger",cancelButtonText:"Cancel",icon:e.jsx(Y,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"}),children:e.jsx("p",{children:"Are you sure you want to delete this comment? This action cannot be undone."})})]})},fe=({post:s,onEditPost:r,onTogglePin:n,onCreateComment:a,onDeleteComment:x,comments:o,commentLoading:d,fetchComments:c})=>{const{user:f,isLoading:i}=te(),{getCurrentStableRole:l}=U(),[h,u]=p.useState(!1),m=()=>{c&&c(s.id),u(!0)},j=l(),b=j===S.ADMIN||j===S.MANAGER,C=String(f?.id)===String(s.userId)||b,v=b,I=D=>{try{return T(P(D),"yyyy-MM-dd")}catch{return"Unknown date"}},k=D=>{try{return T(P(D),"HH:mm")}catch{return""}},t={id:s.userId,firstName:s.posterFirstName||"Unknown",lastName:s.posterLastName||"",profilePicture:s.profilePicture},g=`${t.firstName} ${t.lastName}`.trim()||"Unknown User",M=()=>{n&&n(s)};if(i)return e.jsxs("div",{className:"flex justify-center p-4",children:[e.jsx(E,{size:"small",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:"Loading..."})]});const F=o&&o[s.id]?o[s.id].length:s.commentCount||0;return e.jsxs(V.div,{className:"bg-background pb-2 md:w-9/10 lg:mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-grey opacity-80 md:text-sm"}),e.jsxs("p",{className:"text-xs text-grey opacity-80 md:text-sm",children:["kl ",k(s.date)]})]}),e.jsxs("div",{className:"bg-white w-full rounded-lg px-6 py-2 pt-3 mb-2 shadow-lg md:hidden",children:[e.jsxs("div",{className:"flex justify-between pb-4",children:[e.jsx("div",{className:"w-10 h-10 md:w-13 md:h-13 lg:w-17 lg:h-17 border-1 border-primary rounded-full overflow-hidden",children:e.jsx(O,{user:t,className:"w-full h-full",alt:`Profile image of ${g}`,fallbackUrl:"/images/userPlaceholderRounded.webp",size:"rounded"})}),v&&e.jsx("div",{onClick:M,className:"cursor-pointer",children:e.jsx(A,{className:`w-8 h-8 ${s.isPinned?"text-primary":"text-primary opacity-20"}`})}),!v&&s.isPinned&&e.jsx(A,{className:"w-8 h-8 text-primary"})]}),e.jsx("h3",{className:"pb-4 text-2xl",children:s.title}),e.jsx("p",{className:"max-w-9/10 text-lg",children:s.content}),e.jsx("p",{className:"text-lg text-grey opacity-80 pt-5",children:g}),e.jsxs("div",{className:"flex justify-end",children:[C&&e.jsx(w,{type:"icon",className:"text-primary",onClick:()=>r(s),children:e.jsx(W,{size:32})}),e.jsx(w,{type:"icon",className:"text-primary border-none shadow-none",onClick:()=>m(),children:e.jsx(oe,{size:32})})]})]})]}),e.jsxs("div",{className:"hidden md:block bg-white rounded-lg shadow-lg overflow-hidden lg:mt-4",children:[e.jsxs("div",{className:"px-5 pt-4 pb-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 border border-primary rounded-full overflow-hidden",children:e.jsx(O,{user:t,className:"w-full h-full object-cover",alt:`Profile of ${g}`,size:"rounded"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"font-medium",children:g}),e.jsxs("p",{className:"text-xs text-gray-500",children:[I(s.date)," -",e.jsx("br",{}),"kl"," ",k(s.date)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[C&&e.jsx("div",{className:"flex",children:e.jsx(w,{type:"icon",className:"text-primary",onClick:()=>r(s),children:e.jsx(W,{size:32})})}),v&&e.jsx("div",{onClick:M,className:"cursor-pointer ml-2",children:e.jsx(A,{size:32,className:`${s.isPinned?"text-primary":"text-primary opacity-20"}`})}),!v&&s.isPinned&&e.jsx(A,{className:" text-primary ml-2",size:32})]})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("h3",{className:"md:text-xl mb-3",children:s.title}),e.jsx("p",{className:"mb-4",children:s.content}),s.image&&e.jsx("div",{className:"w-full mb-4",children:e.jsx(O,{src:s.image,alt:"Post image",size:"rounded",className:"w-full h-auto object-cover rounded-lg"})}),e.jsx(me,{count:F,onClick:m}),e.jsx(ue,{onSubmit:a,user:t,postId:s.id,disabled:!a})]})]}),e.jsx(he,{isOpen:h,onClose:()=>u(!1),comments:o?.[s.id]||[],postId:s.id,onCreateComment:a,onDeleteComment:x,loading:d})]})},R=({title:s,posts:r,onEditPost:n,onDeletePost:a,onTogglePin:x,onCreateComment:o,onDeleteComment:d,comments:c,commentLoading:f,fetchComments:i})=>r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h2",{className:"text-3xl",children:s})}),r.map((l,h)=>e.jsx(fe,{post:l,onEditPost:n,onDeletePost:a,onTogglePin:x,onCreateComment:o,onDeleteComment:d,comments:c,commentLoading:f,fetchComments:i},h))]}),pe=({posts:s,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:o,comments:d,commentLoading:c,fetchComments:f})=>{const i=p.useMemo(()=>{const l={today:[],lastWeek:[],older:[]};if(s.length===0)return l;s.forEach(u=>{try{const m=P(u.date);le(m)?l.today.push(u):ae(m)?l.lastWeek.push(u):l.older.push(u)}catch(m){console.error("Error processing post date:",m),l.older.push(u)}});const h=(u,m)=>re(P(u.date),P(m.date));return l.today.sort(h),l.lastWeek.sort(h),l.older.sort(h),l},[s]);return e.jsxs("div",{className:"py-2",children:[i.today.length>0&&e.jsx(R,{title:"Today",posts:i.today,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:o,comments:d,commentLoading:c,fetchComments:f}),i.lastWeek.length>0&&e.jsx(R,{title:"Last week",posts:i.lastWeek,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:o,comments:d,commentLoading:c,fetchComments:f}),i.older.length>0&&e.jsx(R,{title:"Older posts",posts:i.older,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:o,comments:d,commentLoading:c,fetchComments:f})]})};function Pe(){const{stableId:s}=ie(),{currentStable:r,getCurrentStableRole:n,currentUser:a}=U(),[x,o]=p.useState(!1),[d,c]=p.useState(null),f=s||r?.id,i=n(),l=i!==void 0,[h,u]=p.useState(!1),{posts:m,status:{loading:j},loadingState:b,createPost:y,updatePost:C,deletePost:v,togglePinStatus:I,comments:k,commentLoading:t,fetchComments:g,createComment:M,deleteComment:F}=ne(f,a),D=()=>{u(!0)},L=()=>{u(!1)},z=()=>{o(!0),c(null)},Q=N=>{c(N),o(!0)},B=()=>{o(!1),c(null)},_=async N=>{d?await C(N):await y(N),B()},$=async N=>{await v(N)},J=async N=>{try{await I(N.id)}catch(K){console.error("Error toggling pin status:",K)}};return j?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 h-screen",children:[e.jsx(E,{size:"medium",className:"text-gray mb-3"}),e.jsx("p",{className:"text-gray-600 text-center animate-pulse",children:b.getMessage()})]}):e.jsxs("div",{className:"bg-background min-h-screen flex flex-col pb-10",children:[e.jsx("div",{className:"border-b-1 border-light flex justify-center",children:e.jsx(q,{title:"Feed",className:"max-w-6xl mx-auto flex items-center"})}),e.jsxs("div",{className:"flex max-w-5xl mx-auto w-full",children:[e.jsx("div",{className:"flex-1 p-4 md:px-6 lg:w-2/4 mt-8 relative",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(pe,{posts:m,onEditPost:Q,onDeletePost:$,onTogglePin:J,onCreateComment:M,onDeleteComment:F,comments:k,commentLoading:t,fetchComments:g,onCommentsModalOpen:D,onCommentsModalClose:L,className:"bg-white rounded-xl shadow-md"}),m&&m.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 text-center",children:[e.jsx("p",{className:"mb-2",children:"No posts yet"}),l&&e.jsx("button",{onClick:z,className:"text-primary font-medium hover:underline",children:"Create the first post"})]})]})}),e.jsxs(V.div,{className:"hidden md:flex md:flex-col md:w-4/10 lg:w-1/3 p-4 space-y-5 sticky top-58 self-start h-fit",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-3",children:"Stable Info"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Stable:"," ",e.jsx("span",{className:"text-primary",children:r?.name||"Your Stable"})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Your role: ","",i===S.USER?e.jsx("span",{className:"text-primary",children:"User"}):i===S.ADMIN?e.jsx("span",{className:"text-primary",children:"Admin"}):i===S.MANAGER?e.jsx("span",{className:"text-primary",children:"Owner"}):e.jsx("span",{className:"text-primary",children:"User"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-4",children:[e.jsx("h3",{className:"font-medium text-md mb-3",children:"Quick Stats"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Total posts:"," ",e.jsx("span",{className:"text-primary",children:m?.length||0})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Pinned:"," ",e.jsx("span",{className:"text-primary",children:m?.filter(N=>N.isPinned).length||0})]})]}),e.jsx("div",{className:"flex justify-center",children:l&&e.jsxs(w,{type:"primary",className:"w-9/10",onClick:z,children:[e.jsx("span",{className:"mr-5",children:"New post"}),e.jsx(Z,{className:"w-8 h-8"})]})})]})]}),l&&e.jsx("div",{className:"md:hidden fixed bg-primary-light rounded-full border border-light top-33 right-6 z-20",children:e.jsx(w,{type:"primary",variant:"icon",size:"medium",className:"text-primary",onClick:z,"aria-label":"Add new post",children:e.jsx(Z,{})})}),x&&e.jsx(de,{post:d,onSubmit:_,onCancel:B,onDelete:$,title:d?"Edit Post":"New Post"}),h&&e.jsx(CommentsModal,{isOpen:h,onClose:L,comments:k?.[d?.id]||[],postId:d?.id,onCreateComment:M,onDeleteComment:F,loading:t})]})}export{Pe as default};
