import{U as l,j as e,m as n,P as b,B as p,e as C,M as E}from"./index-C0FfkOcl.js";import{r as u}from"./vendor-router-BURTDQSf.js";import{P as i}from"./PermissionGate-Dv_h3ytN.js";import{C as y,S as G,U as $}from"./UserStableRequestsList-VhyoKov8.js";import{u as I}from"./useStableManagement-BSfNakZ5.js";import"./vendor-react-DavUf6mE.js";import"./vendor-forms-DlkW-UdB.js";import"./HandRaisedIcon-C6cWWIob.js";const v=[{id:l.USER,label:"Member"},{id:l.ADMIN,label:"Admin"},{id:l.MANAGER,label:"Owner"}],U=({stableId:d})=>{const[c,N]=u.useState(!1),[a,j]=u.useState(null),[r,o]=u.useState(null),{members:m,loading:w,updateMemberRole:M,removeUserFromStable:R}=I(d),x=s=>{j(s),o(s.role),N(!0)},h=()=>{N(!1),j(null)},A=async()=>{a&&r!==null&&r!==a.role&&(await M(a.id,r)||console.error("Failed to update role"),h())},k=()=>{a&&(R(a.id),h())},g=s=>{const f=v.find(S=>S.id===s);return f?f.label:"Member"},t={[l.MANAGER]:m.filter(s=>s.role===l.MANAGER),[l.ADMIN]:m.filter(s=>s.role===l.ADMIN),[l.USER]:m.filter(s=>s.role===l.USER)};return w?e.jsx("div",{className:"text-center py-4",children:"Loading members..."}):e.jsxs("section",{className:"bg-white rounded-lg shadow-sm md:shadow-md p-4 md:p-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"font-bold mb-1 text-lg md:text-xl",children:"Members"}),e.jsx(i,{requiredRoles:[l.MANAGER],fallback:e.jsx("p",{className:"text-sm mb-4 pt-1 text-gray",children:"Only stable owners can edit a member"}),children:e.jsx("p",{className:"text-sm mb-4 pt-1 text-gray",children:"You can manage all members as the stable owner"})})]}),e.jsxs(n.div,{className:"max-h-64 md:max-h-80 lg:max-h-96 overflow-y-auto pr-1 space-y-1",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.1}}},children:[" ",t[l.MANAGER].length>0&&e.jsxs("section",{className:"mb-3",children:[e.jsx("h3",{className:"text-xs text-gray border-b pb-1 mb-2",children:"Stable Owners"}),t[l.MANAGER].map(s=>e.jsx(i,{requiredRoles:[l.MANAGER],children:e.jsx(n.article,{className:"flex items-center justify-between py-2 px-3 bg-light/30 rounded-lg mb-2 cursor-pointer",variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},whileHover:{backgroundColor:"rgba(2, 122, 72, 0.05)",transition:{duration:.5}},onClick:()=>x(s),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-3",children:e.jsx(b,{user:s,className:"w-full h-full",size:"small"})}),e.jsx("p",{className:"text-sm",children:`${s.firstName} ${s.lastName}`})]})},`member-${s.id}`)},`member-${s.id}`))]}),t[l.ADMIN].length>0&&e.jsxs("section",{className:"mb-3",children:[e.jsx(i,{requiredRoles:[l.MANAGER],children:e.jsx("h3",{className:"text-xs text-gray border-b pb-1 mb-2",children:"Administrators"})}),t[l.ADMIN].map(s=>e.jsx(i,{requiredRoles:[l.MANAGER],children:e.jsxs(n.article,{className:"flex items-center justify-between py-2 px-3 bg-light/30 rounded-lg mb-2 cursor-pointer",variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},whileHover:{backgroundColor:"rgba(2, 122, 72, 0.05)",transition:{duration:.5}},onClick:()=>x(s),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-3",children:e.jsx(b,{user:s,className:"w-full h-full",size:"small"})}),e.jsx("p",{className:"text-sm",children:`${s.firstName} ${s.lastName}`})]}),e.jsx("span",{className:"px-2 py-1 bg-primary-light text-primary rounded-full text-sm",children:g(s.role)})]},`member-${s.id}`)},`member-${s.id}`))]}),t[l.USER].length>0&&e.jsxs("section",{className:"mb-3",children:[e.jsx(i,{requiredRoles:[l.MANAGER],children:e.jsx("h3",{className:"text-xs text-gray border-b pb-1 mb-2",children:"Members"})}),t[l.USER].map(s=>e.jsxs(i,{requiredRoles:[l.MANAGER],children:[e.jsxs(n.article,{className:"flex items-center justify-between py-2 px-3 bg-light/30 rounded-lg mb-2 cursor-pointer",variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},whileHover:{backgroundColor:"rgba(2, 122, 72, 0.05)",transition:{duration:.5}},onClick:()=>x(s),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-3",children:e.jsx(b,{user:s,className:"w-full h-full",size:"small"})}),e.jsx("p",{className:"text-sm",children:`${s.firstName} ${s.lastName}`})]}),e.jsx("span",{className:"px-2 py-1 bg-primary-light text-primary rounded-full text-sm",children:g(s.role)})]},`member-${s.id}`)," "]},`member-${s.id}`))]})]}),c&&a&&e.jsx("div",{className:"fixed inset-0 bg-gray/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-11/12 max-w-md p-4",children:[e.jsxs("h3",{className:"mb-2 text-lg",children:["Manage member"," ",e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[a.firstName," ",a.lastName]})]}),e.jsx("div",{className:"border-t py-3 mb-2",children:e.jsxs("fieldset",{className:"grid grid-cols-4 gap-1 mb-3",children:[v.map(s=>e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm mb-2 block",children:s.label}),e.jsx("div",{className:`w-5 h-5 mx-auto rounded-full border flex items-center justify-center cursor-pointer ${r===s.id?"border-primary bg-primary":"border-gray"}`,onClick:()=>o(s.id),role:"radio","aria-checked":r===s.id,tabIndex:0,children:r===s.id&&e.jsx(y,{className:"text-white w-4 h-4"})})]},s.id)),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm mb-2 text-error-500 block",children:"Remove"}),e.jsx("div",{className:`w-5 h-5 mx-auto rounded-full border flex items-center justify-center cursor-pointer ${r==="remove"?"border-error-500 bg-error-500":"border-gray"}`,onClick:()=>o("remove"),role:"radio","aria-checked":r==="remove",tabIndex:0,children:r==="remove"&&e.jsx(y,{className:"text-white w-4 h-4"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(p,{type:"secondary",onClick:h,children:"Cancel"}),e.jsx(p,{type:"primary",onClick:()=>{r==="remove"?k():r!==null&&r!==a.role&&A()},disabled:r===null||r!=="remove"&&r===a.role,children:"Save"})]})]})})]})},F=()=>{const{currentStable:d}=C(),c=()=>{window.history.back()};return e.jsx(i,{requiredRoles:[l.ADMIN,l.MANAGER],children:e.jsxs("div",{className:"flex flex-col min-h-screen bg-background pb-35 overflow-y-hidden",children:[e.jsx("div",{className:"bg-primary-light lg:bg-background",children:e.jsx(E,{title:"Manage Stables",showCloseBtn:!1,onCloseClick:()=>window.history.back()})}),e.jsx("div",{className:"flex-1 px-4 py-6 md:px-8 lg:px-16 xl:px-80 ",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(U,{stableId:d?.id}),e.jsx(G,{stableId:d?.id}),e.jsx($,{}),e.jsx("div",{className:"hidden lg:flex justify-start",children:e.jsx(p,{type:"secondary",onClick:c,className:"w-auto",children:"Go back"})})]})})]})})};export{F as default};
