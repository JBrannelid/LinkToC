const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/horseService-0RQovo7f.js","assets/index-C0FfkOcl.js","assets/vendor-react-DavUf6mE.js","assets/vendor-router-BURTDQSf.js","assets/vendor-forms-DlkW-UdB.js","assets/index-CTFL713y.css"])))=>i.map(i=>d[i]);
import{u as P,j as r,M as V,F as q,a as b,B as _,_ as M,d as k}from"./index-C0FfkOcl.js";import{r as x}from"./vendor-router-BURTDQSf.js";import{a as A}from"./vendor-forms-DlkW-UdB.js";import{F as N}from"./FormMessage-BcmBGiAa.js";import"./JoinStableForm-HlQU7VTx.js";const H=({isOpen:m,onClose:i,fieldName:t,fieldLabel:a,initialValue:F="",userId:n,multiline:B=!1,userData:e,refreshUserData:w,isHorse:y=!1,isCurrentUser:d=!1})=>{const{user:p}=P(),[u,v]=x.useState(!1),[S,l]=x.useState(null),T=A({defaultValues:{[t]:F}});x.useEffect(()=>{m&&!d&&String(p?.id)!==String(n)&&(l({type:"error",text:"You don't have permission to edit this profile"}),setTimeout(()=>i(),2e3))},[m,y,p?.id,n,i,d]);const I=async h=>{if(!d&&String(p?.id)!==String(n))return l({type:"error",text:"You don't have permission to edit this profile"}),setTimeout(()=>i(),2e3),{success:!1};try{v(!0),l(null);let s;if(y)try{const f=(await M(()=>import("./horseService-0RQovo7f.js"),__vite__mapDeps([0,1,2,3,4,5]))).default,o=j=>{if(!j)return null;const E=j.toString().replace(/[^\d]/g,"");return E?parseInt(E,10):null},g={id:n,name:e?.name||"",breed:e?.breed||"",color:e?.color||"",age:e?.age||null,description:e?.description||"",bio:e?.bio||"",coreInformation:e?.coreInformation||"",weight:o(e?.weight),height:o(e?.height),currentBox:o(e?.currentBox||e?.stablePlace||"")};t==="height"||t==="weight"||t==="currentBox"?g[t]=o(h[t]):g[t]=h[t],s=await f.updateHorse(g,n)}catch(c){throw new Error("Could not update horse: "+c.message)}else{const c=await M(()=>import("./index-C0FfkOcl.js").then(o=>o.a7),__vite__mapDeps([1,2,3,4,5])).then(o=>o.default),f={id:n,firstName:e?.firstName||"",lastName:e?.lastName||"",email:e?.email||"",phoneNumber:e?.phoneNumber||"",emergencyContact:e?.emergencyContact||"",coreInformation:e?.coreInformation||"",description:e?.description||"",[t]:h[t]};s=await c.update(f)}if(s.success||s.isSuccess||s.statusCode===200){if(l(k("Information updated successfully")),typeof w=="function")try{await w()}catch(c){console.error("Error during refresh:",c)}return setTimeout(()=>{i()},2e3),{success:!0}}else throw new Error(s?.message||"Update failed")}catch(s){return l({type:"error",text:s.message||"Failed to update information"}),{success:!1,error:s.message}}finally{v(!1)}};return m?r.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-30 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md",children:[r.jsx(V,{title:`Edit ${a}`,showCloseBtn:!0,onCloseClick:i}),r.jsx("div",{className:"p-4",children:r.jsxs(q,{methods:T,onSubmit:I,children:[B?r.jsx(b,{name:t,type:"textarea",label:a,rows:5,validation:{required:`${a} is required`}}):r.jsx(b,{name:t,label:a,validation:{required:`${a} is required`}}),S&&r.jsx(N,{message:S,className:"mt-4"}),r.jsxs("div",{className:"flex justify-center mt-6 space-x-4",children:[r.jsx(_,{type:"primary",htmlType:"submit",loading:u,disabled:u,className:"w-full",children:u?"Saving...":"Save"}),r.jsx(_,{type:"secondary",onClick:i,disabled:u,className:"w-full",children:"Cancel"})]})]})})]})}):null};export{H as E};
