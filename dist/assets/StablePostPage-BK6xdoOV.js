import{j as e,r as s,h as t}from"./vendor-react-B_QZno8V.js";import{h as l,i as n,y as a,P as o,H as r,z as i,B as m,U as c,a as d,m as x,D as h,f as u,E as p,G as j,I as g,K as N,M as f,L as y}from"./form-components-BwsA2IIA.js";import{L as b,B as C,c as v,M as w}from"./ui-components-3MKBAZVk.js";const k=({size:s=24,color:t="currentColor",className:l="",strokeWidth:n=1.5,...a})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",className:l,...a,children:e.jsx("path",{fill:t,d:"M16,6l-13,0c-0.552,0 -1,0.448 -1,1l0,22c0,0.552 0.448,1 1,1l22,0c0.552,0 1,-0.448 1,-1l0,-13c0,-0.552 -0.448,-1 -1,-1c-0.552,-0 -1,0.448 -1,1l0,12c0,0 -20,0 -20,0c0,0 0,-20 0,-20c-0,0 12,0 12,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1Zm-9,19l14,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-14,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm-0,-4l4,0c0.552,-0 1,-0.448 1,-1c-0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,-0 -1,0.448 -1,1c-0,0.552 0.448,1 1,1Zm22.707,-13.293c0.391,-0.39 0.391,-1.024 0,-1.414l-4,-4c-0.39,-0.391 -1.024,-0.391 -1.414,-0l-10,10c-0.14,0.139 -0.235,0.317 -0.274,0.511l-1,5c-0.065,0.328 0.037,0.667 0.274,0.903c0.236,0.237 0.575,0.339 0.903,0.274l5,-1c0.194,-0.039 0.372,-0.134 0.511,-0.274l10,-10Zm-22.707,9.293l4,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm0,-4l5,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-5,-0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Z",strokeWidth:n})}),P=({count:s,onClick:t})=>e.jsx("div",{className:"flex justify-end items-center text-gray mt-2 pb-2 border-b-1 border-primary cursor-pointer hover:text-primary",onClick:t,children:e.jsxs("span",{className:"text-sm",children:[s," comments"]})}),D=({size:s=24,color:t="currentColor",strokeWidth:l=2,className:n=""})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,children:e.jsx("path",{d:"M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z",stroke:t,strokeWidth:l,strokeLinecap:"round",strokeLinejoin:"round"})}),S=({onSubmit:t,postId:a,disabled:o=!1})=>{const[r,i]=s.useState(""),{currentUser:m}=l();return e.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&t&&(t(a,r),i(""))},className:"mt-3 flex",children:[e.jsx(D,{className:"w-7 h-7 mr-1 text-primary"}),e.jsx("div",{className:"flex-grow bg-light/40 rounded-full",children:e.jsx("input",{type:"text",placeholder:`Comment as ${n(m)}...`,className:"w-full px-3 py-1 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary",value:r,onChange:e=>i(e.target.value),disabled:o})})]})},z=({isOpen:t,onClose:n,comments:d=[],postId:x,onCreateComment:h,onDeleteComment:u,loading:p})=>{const{currentUser:j,getCurrentStableRole:g}=l(),[N,f]=s.useState(""),[y,w]=s.useState(null),[k,P]=s.useState(!1),D=g(),S=D===c.ADMIN||D===c.MANAGER;if(!t)return null;const z=e=>{try{const s=i(e);return m(s,"MM/dd-yy HH:mm")}catch{return"Unknown date"}};return e.jsxs("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-30",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-9/10 md:max-w-5/10 h-7/10 flex flex-col relative",children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-2xl font-semibold text-center",children:"Comments"}),e.jsx("button",{onClick:n,className:"absolute top-4 right-4","aria-label":"Close",children:e.jsx(a,{size:30,strokeWidth:2,className:"text-primary "})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 max-h-96",children:p?e.jsxs("div",{className:"flex justify-center items-center h-40",children:[e.jsx(b,{size:"medium"}),e.jsx("p",{className:"ml-2",children:"Loading comments..."})]}):e.jsx("div",{className:"space-y-4",children:d&&d.length>0?d.map(((s,t)=>e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:"absolute left-0 top-2",children:e.jsx(o,{user:{id:s.userId,profilePicture:s.profilePicture,firstName:s.firstName||"",lastName:s.lastName||""},className:"w-12 h-12 rounded-full object-cover border border-light",alt:`${s.firstName||"User"} ${s.lastName||""}'s avatar`,size:"rounded"})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-sm text-gray",children:z(s.commentDate)})}),e.jsxs("div",{className:"border border-gray rounded-lg p-4 "+(S||s.userId===(null==j?void 0:j.id)?"hover:bg-light/30 cursor-pointer":""),onClick:()=>(e=>{(S||e.userId===(null==j?void 0:j.id))&&(w(e),P(!0))})(s),children:[e.jsx("div",{className:"flex mb-2",children:e.jsxs("p",{className:"font-bold",children:[s.firstName," ",s.lastName]})}),e.jsx("p",{className:"text-black break-words",children:s.content})]})]},t))):e.jsx("p",{className:"text-center py-8 text-gray",children:"No comments yet"})})}),e.jsx("div",{className:"border-t border-light p-4",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),N.trim()&&(h(x,N),f(""))},className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Add a comment...",className:"flex-grow px-4 py-3 border border-light rounded-lg focus:outline-none focus:ring-1 focus:ring-primary",value:N,onChange:e=>f(e.target.value)}),e.jsxs(C,{type:"primary",htmlType:"submit",className:"rounded-lg px-6 py-3",disabled:p||!N.trim(),children:[e.jsx("span",{className:"block md:hidden",children:"+"}),e.jsx("span",{className:"hidden md:block",children:"Comment"})]})]})})]}),e.jsx(v,{isOpen:k,onClose:()=>P(!1),onConfirm:()=>{y&&(u(y.id,x),P(!1),w(null))},title:"Delete Comment",confirmButtonText:"Delete",confirmButtonType:"danger",cancelButtonText:"Cancel",icon:e.jsx(r,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"}),children:e.jsx("p",{children:"Are you sure you want to delete this comment? This action cannot be undone."})})]})},L=({post:t,onEditPost:n,onTogglePin:a,onCreateComment:r,onDeleteComment:p,comments:j,commentLoading:g,fetchComments:N})=>{const{user:f,isLoading:y}=d(),{getCurrentStableRole:v}=l(),[k,D]=s.useState(!1),L=()=>{N&&N(t.id),D(!0)},M=v(),I=M===c.ADMIN||M===c.MANAGER,E=String(null==f?void 0:f.id)===String(t.userId)||I,T=I,U=e=>{try{return m(i(e),"HH:mm")}catch{return""}},A={id:t.userId,firstName:t.posterFirstName||"Unknown",lastName:t.posterLastName||"",profilePicture:t.profilePicture},W=`${A.firstName} ${A.lastName}`.trim()||"Unknown User",R=()=>{a&&a(t)};if(y)return e.jsxs("div",{className:"flex justify-center p-4",children:[e.jsx(b,{size:"small",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:"Loading..."})]});const B=j&&j[t.id]?j[t.id].length:t.commentCount||0;return e.jsxs(x.div,{className:"bg-background pb-2 md:w-9/10 lg:mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-grey opacity-80 md:text-sm"}),e.jsxs("p",{className:"text-xs text-grey opacity-80 md:text-sm",children:["kl ",U(t.date)]})]}),e.jsxs("div",{className:"bg-white w-full rounded-lg px-6 py-2 pt-3 mb-2 shadow-lg md:hidden",children:[e.jsxs("div",{className:"flex justify-between pb-4",children:[e.jsx("div",{className:"w-10 h-10 md:w-13 md:h-13 lg:w-17 lg:h-17 border-1 border-primary rounded-full overflow-hidden",children:e.jsx(o,{user:A,className:"w-full h-full",alt:`Profile image of ${W}`,fallbackUrl:"/src/assets/images/userPlaceholderRounded.webp",size:"rounded"})}),T&&e.jsx("div",{onClick:R,className:"cursor-pointer",children:e.jsx(h,{className:"w-8 h-8 "+(t.isPinned?"text-primary":"text-primary opacity-20")})}),!T&&t.isPinned&&e.jsx(h,{className:"w-8 h-8 text-primary"})]}),e.jsx("h3",{className:"pb-4 text-2xl",children:t.title}),e.jsx("p",{className:"max-w-9/10 text-lg",children:t.content}),e.jsx("p",{className:"text-lg text-grey opacity-80 pt-5",children:W}),e.jsxs("div",{className:"flex justify-end",children:[E&&e.jsx(C,{type:"icon",className:"text-primary",onClick:()=>n(t),children:e.jsx(u,{size:32})}),e.jsx(C,{type:"icon",className:"text-primary border-none shadow-none",onClick:()=>L(),children:e.jsx(w,{size:32})})]})]})]}),e.jsxs("div",{className:"hidden md:block bg-white rounded-lg shadow-lg overflow-hidden lg:mt-4",children:[e.jsxs("div",{className:"px-5 pt-4 pb-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 border border-primary rounded-full overflow-hidden",children:e.jsx(o,{user:A,className:"w-full h-full object-cover",alt:`Profile of ${W}`,size:"rounded"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"font-medium",children:W}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(e=>{try{return m(i(e),"yyyy-MM-dd")}catch{return"Unknown date"}})(t.date)," -",e.jsx("br",{}),"kl"," ",U(t.date)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[E&&e.jsx("div",{className:"flex",children:e.jsx(C,{type:"icon",className:"text-primary",onClick:()=>n(t),children:e.jsx(u,{size:32})})}),T&&e.jsx("div",{onClick:R,className:"cursor-pointer ml-2",children:e.jsx(h,{size:32,className:""+(t.isPinned?"text-primary":"text-primary opacity-20")})}),!T&&t.isPinned&&e.jsx(h,{className:" text-primary ml-2",size:32})]})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("h3",{className:"md:text-xl mb-3",children:t.title}),e.jsx("p",{className:"mb-4",children:t.content}),t.image&&e.jsx("div",{className:"w-full mb-4",children:e.jsx(o,{src:t.image,alt:"Post image",size:"rounded",className:"w-full h-auto object-cover rounded-lg"})}),e.jsx(P,{count:B,onClick:L}),e.jsx(S,{onSubmit:r,user:A,postId:t.id,disabled:!r})]})]}),e.jsx(z,{isOpen:k,onClose:()=>D(!1),comments:(null==j?void 0:j[t.id])||[],postId:t.id,onCreateComment:r,onDeleteComment:p,loading:g})]})},M=({title:s,posts:t,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:i,commentLoading:m,fetchComments:c})=>0===t.length?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h2",{className:"text-3xl",children:s})}),t.map(((s,t)=>e.jsx(L,{post:s,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:i,commentLoading:m,fetchComments:c},t)))]}),I=({posts:t,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:m,commentLoading:c,fetchComments:d})=>{const x=s.useMemo((()=>{const e={today:[],lastWeek:[],older:[]};if(0===t.length)return e;t.forEach((s=>{try{const t=i(s.date);p(t)?e.today.push(s):j(t)?e.lastWeek.push(s):e.older.push(s)}catch(t){e.older.push(s)}}));const s=(e,s)=>g(i(e.date),i(s.date));return e.today.sort(s),e.lastWeek.sort(s),e.older.sort(s),e}),[t]);return e.jsxs("div",{className:"py-2",children:[x.today.length>0&&e.jsx(M,{title:"Today",posts:x.today,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:m,commentLoading:c,fetchComments:d}),x.lastWeek.length>0&&e.jsx(M,{title:"Last week",posts:x.lastWeek,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:m,commentLoading:c,fetchComments:d}),x.older.length>0&&e.jsx(M,{title:"Older posts",posts:x.older,onEditPost:l,onDeletePost:n,onTogglePin:a,onCreateComment:o,onDeleteComment:r,comments:m,commentLoading:c,fetchComments:d})]})};function E(){const{stableId:n}=t(),{currentStable:a,getCurrentStableRole:o,currentUser:r}=l(),[i,m]=s.useState(!1),[d,h]=s.useState(null),u=n||(null==a?void 0:a.id),p=o(),j=void 0!==p,[g,v]=s.useState(!1),{posts:w,status:{loading:P},loadingState:D,createPost:S,updatePost:z,deletePost:L,togglePinStatus:M,comments:E,commentLoading:T,fetchComments:U,createComment:A,deleteComment:W}=N(u,r),R=()=>{v(!1)},B=()=>{m(!0),h(null)},O=()=>{m(!1),h(null)},Z=async e=>{await L(e)};return P?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 h-screen",children:[e.jsx(b,{size:"medium",className:"text-gray mb-3"}),e.jsx("p",{className:"text-gray-600 text-center animate-pulse",children:D.getMessage()})]}):e.jsxs("div",{className:"bg-background min-h-screen flex flex-col pb-10",children:[e.jsx("div",{className:"border-b-1 border-light flex justify-center",children:e.jsx(f,{title:"Feed",className:"max-w-6xl mx-auto flex items-center"})}),e.jsxs("div",{className:"flex max-w-5xl mx-auto w-full",children:[e.jsx("div",{className:"flex-1 p-4 md:px-6 lg:w-2/4 mt-8 relative",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{posts:w,onEditPost:e=>{h(e),m(!0)},onDeletePost:Z,onTogglePin:async e=>{try{await M(e.id)}catch(s){}},onCreateComment:A,onDeleteComment:W,comments:E,commentLoading:T,fetchComments:U,onCommentsModalOpen:()=>{v(!0)},onCommentsModalClose:R,className:"bg-white rounded-xl shadow-md"}),w&&0===w.length&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 text-center",children:[e.jsx("p",{className:"mb-2",children:"No posts yet"}),j&&e.jsx("button",{onClick:B,className:"text-primary font-medium hover:underline",children:"Create the first post"})]})]})}),e.jsxs(x.div,{className:"hidden md:flex md:flex-col md:w-4/10 lg:w-1/3 p-4 space-y-5 sticky top-58 self-start h-fit",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-3",children:"Stable Info"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Stable:"," ",e.jsx("span",{className:"text-primary",children:(null==a?void 0:a.name)||"Your Stable"})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Your role: ","",p===c.USER?e.jsx("span",{className:"text-primary",children:"User"}):p===c.ADMIN?e.jsx("span",{className:"text-primary",children:"Admin"}):p===c.MANAGER?e.jsx("span",{className:"text-primary",children:"Owner"}):e.jsx("span",{className:"text-primary",children:"User"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-4",children:[e.jsx("h3",{className:"font-medium text-md mb-3",children:"Quick Stats"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Total posts:"," ",e.jsx("span",{className:"text-primary",children:(null==w?void 0:w.length)||0})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Pinned:"," ",e.jsx("span",{className:"text-primary",children:(null==w?void 0:w.filter((e=>e.isPinned)).length)||0})]})]}),e.jsx("div",{className:"flex justify-center",children:j&&e.jsxs(C,{type:"primary",className:"w-9/10",onClick:B,children:[e.jsx("span",{className:"mr-5",children:"New post"}),e.jsx(k,{className:"w-8 h-8"})]})})]})]}),j&&e.jsx("div",{className:"md:hidden fixed bg-primary-light rounded-full border border-light top-33 right-6 z-20",children:e.jsx(C,{type:"primary",variant:"icon",size:"medium",className:"text-primary",onClick:B,"aria-label":"Add new post",children:e.jsx(k,{})})}),i&&e.jsx(y,{post:d,onSubmit:async e=>{d?await z(e):await S(e),O()},onCancel:O,onDelete:Z,title:d?"Edit Post":"New Post"}),g&&e.jsx(CommentsModal,{isOpen:g,onClose:R,comments:(null==E?void 0:E[null==d?void 0:d.id])||[],postId:null==d?void 0:d.id,onCreateComment:A,onDeleteComment:W,loading:T})]})}export{E as default};
