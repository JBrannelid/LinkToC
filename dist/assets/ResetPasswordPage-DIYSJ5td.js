import{z as i,j as e,F as b,a as f,B as g,c as v,d as k,R as w,g as L,W as S,L as p}from"./index-B8Zmxeox.js";import{r as o,u as R,a as F}from"./vendor-router-BURTDQSf.js";import{a as E}from"./vendor-forms-DlkW-UdB.js";import{F as T}from"./FormMessage-fA-TKUr1.js";import"./vendor-react-DavUf6mE.js";const h=({setParentLoading:a=null})=>{const[s,d]=o.useState(!1),[y,r]=o.useState({type:"",text:""}),[c,j]=o.useState(""),m=R(),u=F(),N=E({defaultValues:{password:"",confirmPassword:""}});o.useEffect(()=>{const t=new URLSearchParams(u.search).get("token");t?j(t):(console.error("No token found in URL"),r(i("No reset code found. Please check the link in your email")))},[u]),o.useEffect(()=>{a&&a(s)},[s,a]);const x=()=>{m(w.LOGIN)},P=async n=>{if(!c){r(i("No reset code available. Please request a new reset link."));return}if(n.password!==n.confirmPassword){r(i("Passwords don't match. Please try again."));return}d(!0),r({type:"",text:""});try{const t={token:c,newPassword:n.password,confirmPassword:n.confirmPassword},l=await v.resetPassword(t);l&&l.isSuccess?(r(k("Your password has been reset. You will be redirected to the login page.")),setTimeout(()=>{m(w.LOGIN)},3e3)):(console.error("API returned unsuccessful response:",l),r(i(l?.message||"Something went wrong. Please try again.")))}catch(t){r(L(t,{defaultMessage:"Failed to reset password. Please try again later."}))}finally{d(!1)}};return e.jsxs(b,{methods:N,onSubmit:P,className:"w-full",ariaLabel:"Reset Password Form",children:[e.jsx("div",{className:"mt-4",children:e.jsx(f,{name:"password",type:"password",placeholder:"Enter new password",showPasswordToggle:!0,inputClassName:"w-full px-3 py-4 border !bg-white !border-gray rounded-md focus:outline-none focus:ring-primary focus:ring-1 focus:border-primary",validation:{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}})}),e.jsx("div",{className:"mt-4",children:e.jsx(f,{name:"confirmPassword",type:"password",placeholder:"Confirm your new password",showPasswordToggle:!0,inputClassName:"w-full px-3 py-4 border !bg-white !border-gray rounded-md focus:outline-none focus:ring-primary focus:ring-1 focus:border-primary",validation:{required:"Please confirm your password"}})}),e.jsx(T,{message:y,className:"mt-4"}),e.jsxs("div",{className:"mt-6 flex flex-col items-center gap-4",children:[e.jsx(g,{type:"primary",htmlType:"submit",className:"w-9/10",disabled:s||!c,"aria-busy":s,children:e.jsx("span",{children:"Reset Password"})}),e.jsx(g,{type:"secondary",onClick:x,className:"w-9/10 lg:hidden",children:e.jsx("span",{children:"Back to Login"})}),e.jsxs("div",{className:"hidden lg:flex lg:justify-center lg:items-center lg:gap-2 lg:mt-2 w-full",children:[e.jsx("span",{className:"text-sm text-gray items-center",children:"Go back to"}),e.jsx("button",{type:"button",className:"text-sm font-semibold text-primary hover:underline focus:outline-none",onClick:x,children:"Sign in"})]})]})]})},U=()=>{const[a,s]=o.useState(!1);return e.jsxs(S,{children:[e.jsx("div",{className:"flex flex-col lg:hidden",children:e.jsx("div",{className:"flex-1 bg-transparent overflow-y-auto",children:e.jsx("div",{className:"w-full max-w-md mx-auto",children:a?e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx(p,{size:"medium",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:"Processing..."})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-medium text-center mb-2 mt-3",children:"Reset Password"}),e.jsx("p",{className:"text-center text-gray-600 mb-1",children:"Enter your new password below"}),e.jsx(h,{setParentLoading:s})]})})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-medium text-center mb-8",children:"Reset Password"}),a?e.jsxs("div",{className:"flex items-center justify-center w-full",children:[e.jsx(p,{size:"medium",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:"Processing..."})]}):e.jsx("div",{children:e.jsx(h,{setParentLoading:s})})]})})]})};export{U as default};
