import{z as B,j as e,M as O,F as M,a as y,L as A,B as k,u as P,e as q,D as T,g as C,b as I,E as L}from"./index-wFcmRMOn.js";import{r as a}from"./vendor-router-BURTDQSf.js";import{u as z}from"./JoinStableForm-D6pZO4Pu.js";import{F as E}from"./FormMessage-C9uy2WXL.js";import{a as R}from"./vendor-forms-DlkW-UdB.js";const G=({formMethods:r,onSubmit:b,onCancel:f,isLoading:l=!1,loadingState:h=null,error:p=null,message:n=null,desktopView:g=!1,inputClassName:S="",hideLabel:m=!1})=>{const[c,j]=a.useState(null),{locationData:u,isLoading:N,message:i,fetchLocationData:F}=z(),x=r.handleSubmit(o=>{if(j(null),b)try{b(o)}catch{j(B("An error occurred when creating stable! Try again later."))}}),w=o=>{const t=o.target.value;t&&t.trim()!==""&&F(t)};a.useEffect(()=>{u&&(r.setValue("county",u.countyName,{shouldValidate:!0}),r.clearErrors("county"))},[u,r]);const d=`bg-white w-1/3 px-2 py-3 border-2 w-full rounded-md !border-primary focus:outline-none focus:ring-primary focus:ring-1 focus:border-primary ${S}`,s=c||(i?.type==="error"?i:null)||(p?{type:"error",text:p}:null);return e.jsxs("div",{children:[!g&&e.jsx("div",{className:"bg-background",children:e.jsx(O,{title:"Create a new stable"})}),e.jsxs(M,{methods:r,onSubmit:x,className:"w-full",showFooter:{showFooter:!1},children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{children:[!m&&e.jsx("label",{htmlFor:"stableName",className:"block text-sm mb-1 font-medium",children:"Choose Stable Name"}),e.jsx(y,{id:"stableName",name:"stableName",placeholder:"Stable Name...",validation:{required:"Stable name is mandatory"},inputClassName:d,disabled:l,"aria-required":"true"})]}),e.jsxs("div",{className:"space-y-3",children:[!m&&e.jsx("label",{htmlFor:"streetAddress",className:"block text-sm mb-1 font-medium",children:"Stable Address"}),e.jsx(y,{id:"streetAddress",name:"streetAddress",placeholder:"Address...",inputClassName:d}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"postCode",name:"postCode",placeholder:"Postcode...",inputClassName:d,onBlur:w,"aria-describedby":"postcode-info"}),N&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(A,{size:"small",withMargin:!1})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"county",name:"county",placeholder:"County...",validation:{required:"County is mandatory"},inputClassName:d,disabled:l,"aria-required":"true","aria-autocomplete":"list","aria-describedby":"county-info"}),N&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(A,{size:"small",withMargin:!1})})]})]}),i?.type==="error"&&e.jsx("div",{id:"postcode-info",className:"text-sm text-red-500","aria-live":"polite",children:i.text})]}),e.jsxs("div",{children:[!m&&e.jsx("label",{htmlFor:"typeOfStable",className:"block text-sm mb-1 font-medium",children:"Type of stable"}),e.jsxs("select",{id:"typeOfStable",name:"typeOfStable",className:d,disabled:l,...r.register("typeOfStable",{required:"Please select a stable type"}),children:[e.jsx("option",{value:"",children:"Select stable type..."}),e.jsx("option",{value:"Private stable",children:"Private stable"}),e.jsx("option",{value:"Commercial stable",children:"Commercial stable"})]}),r.formState.errors.typeOfStable&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.formState.errors.typeOfStable.message})]}),e.jsxs("div",{children:[!m&&e.jsx("label",{htmlFor:"stableBoxes",className:"block text-sm mb-1 font-medium",children:"Number of boxes in the stable"}),e.jsx("div",{className:"flex w-4/10",children:e.jsx(y,{id:"stableBoxes",name:"stableBoxes",placeholder:"Boxes...",type:"number",min:"0",inputClassName:d,disabled:l,"aria-label":"Number of boxes"})})]})]}),s&&e.jsx(E,{message:s}),!s&&i?.type==="success"&&!n&&e.jsx(E,{message:i}),n&&n.text&&!s&&e.jsx(E,{message:n}),e.jsxs("div",{className:"space-y-3 mt-8 flex flex-col items-center",children:[e.jsx(k,{type:"primary",htmlType:"submit",onClick:x,loading:l,disabled:l,className:"w-9/10","aria-busy":l?"true":"false",children:l&&h?h.getMessage():"Create Stable"}),!g&&f&&e.jsx(k,{type:"secondary",onClick:f,disabled:l,className:"w-9/10",children:"Return"})]})]})]})},K=()=>{const{user:r}=P(),{changeStable:b}=q(),f=R({defaultValues:{stableName:"",streetAddress:"",postCode:"",county:"",typeOfStable:"Private Stable",stableBoxes:""},mode:"onChange"}),[l,h]=a.useState("welcome"),[p,n]=a.useState(!1),[g,S]=a.useState("create"),[m,c]=a.useState(null),[j,u]=a.useState({type:"",text:""}),[N,i]=a.useState(!0);a.useEffect(()=>{const s=async()=>{try{if(sessionStorage.getItem("isFirstLogin")==="true"){i(!0);return}const t=await L.getUserStables(r.id);i(t.length===0)}catch(o){console.error("Error checking first login status:",o),i(!0)}};r?.id&&s()},[r]),a.useEffect(()=>{c(null),u({type:"",text:""})},[l]);const F=a.useCallback(s=>{h(s),c(null),u({type:"",text:""})},[]),x=a.useCallback(async s=>{if(!s.stableName||!s.stableName.trim())return u({type:"error",text:"Stable Name is required"}),{success:!1};n(!0),S("create"),c(null),u({type:"",text:""});try{const o={stableName:s.stableName.trim(),streetAddress:s.streetAddress,postCode:s.postCode,county:s.county,typeOfStable:s.typeOfStable,stableBoxes:parseInt(s.stableBoxes,10)||0},t=await T.createStable(o);if(t&&t.isSuccess){const v=t.value;return u({type:"success",text:t.message||"Stable created successfully."}),{success:!0,stable:v,message:t.message}}else{const v=C({type:"server",message:t?.message||"Unavailable to create stable."}).text;return c(v),{success:!1,error:v}}}catch(o){const t=C(o,{defaultMessage:"An error occurred while creating the stable."}).text;return c(t),{success:!1,error:t}}finally{n(!1)}},[]),w=a.useCallback(async(s,o)=>{if(!s)return c("Invalid stable selection"),{success:!1};n(!0),S("update"),c(null);try{return b(s,o),{success:!0}}catch(t){return c(C(t).text),{success:!1,error:C(t).text}}finally{n(!1)}},[b]),d=I(p,g);return{currentStep:l,isFirstLogin:N,loading:p,error:m,message:j,loadingState:d,formMethods:f,navigateToStep:F,handleCreateStable:x,handleJoinStable:w,submitStableForm:s=>x(s)}};export{G as C,K as u};
