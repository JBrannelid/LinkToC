import{r as e,u as t,j as s}from"./vendor-react-B_QZno8V.js";import{h as a,a as l,w as n,x as r,e as i,M as o,R as c,d as m,S as d,U as u,C as x,J as b,H as h}from"./form-components-BwsA2IIA.js";import{L as f,C as g,a as p,B as j,c as y}from"./ui-components-3MKBAZVk.js";import{u as w}from"./useStableOnboarding-DxnGwu5l.js";const N=()=>{const{changeStable:N}=a(),{user:S}=l(),C=t(),{stables:k,loading:T,loadingState:A,refetch:R}=n(),{deleteStable:M,leaveStable:B}=r(),E=e.useRef(null),[L,O]=e.useState(null),[$,I]=e.useState(null),{elementRef:U,scrollIntoView:F}=(()=>{const t=e.useRef(null),s=e.useCallback(((e={})=>{const{setFocus:s=!0,block:a="start",behavior:l="smooth",delay:n=100}=e;t.current&&setTimeout((()=>{if(t.current.scrollIntoView({behavior:l,block:a}),s){const e=t.current.querySelector('input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])');e?e.focus():(t.current.setAttribute("tabindex","-1"),t.current.focus(),t.current.removeAttribute("tabindex"))}}),n)}),[]);return{elementRef:t,scrollIntoView:s}})(),[D,V]=e.useState(!1),[Y,q]=e.useState({isOpen:!1,stable:null,action:null}),{loading:z,error:G,message:H,loadingState:P,formMethods:J,handleCreateStable:Q}=w();e.useEffect((()=>{var e;if(null==(e=location.state)?void 0:e.message){I(i(location.state.message));const e=setTimeout((()=>{I(null)}),5e3);return C(location.pathname,{replace:!0,state:{}}),()=>clearTimeout(e)}}),[C]);const W=(e,t,s)=>{s.stopPropagation(),q({isOpen:!0,stable:e,action:t})},_=()=>{q({isOpen:!1,stable:null,action:null})},K=e=>{sessionStorage.getItem("newStableCreated");N(e.id,e.name)&&C(c.HOME)},X=()=>{O(null)};if(T)return s.jsxs("div",{className:" bg-background flex flex-col items-center justify-center",children:[s.jsx(f,{size:"large",className:"text-primary mb-4"}),s.jsx("p",{className:"text-gray-600",children:A.getMessage()})]});const Z=(null==S?void 0:S.firstName)&&(null==S?void 0:S.lastName)?`${S.firstName} ${S.lastName}`.trim():"Unknown User",ee=(()=>{const{stable:e,action:t}=Y;return"delete"===t?{title:`Delete stable "${(null==e?void 0:e.name)||""}"?`,confirmText:"Delete",buttonType:"danger",iconBg:"bg-error-500",message:"This action cannot be undone. All data associated with this stable will be permanently deleted."}:"leave"===t?{title:`Leave stable "${(null==e?void 0:e.name)||""}"?`,confirmText:"Leave",buttonType:"warning",iconBg:"bg-warning-400",message:"Are you sure you want to leave this stable? You'll need to send another invite to join the stable again."}:{}})();return s.jsxs("div",{className:"flex flex-col bg-background pb-20 lg:pb-0 overflow-y-auto",children:[s.jsx("div",{className:"bg-primary-light lg:bg-background lg:hidden",children:s.jsx(o,{title:"Select Stable",showCloseBtn:!1})}),s.jsxs("div",{className:"px-4 py-4 mx-auto md:pt-10 lg:pt-15",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsxs("h2",{className:"text-xl md:text-2xl mb-2",children:["Welcome ",Z,"!"]}),s.jsxs("p",{className:"text-gray pt-5",children:["Choose a stable to work with today, explore new ones, or"," ",s.jsx("span",{className:"text-primary cursor-pointer hover:underline font-semibold",onClick:()=>C(c.STABLE_REQUESTS),children:"check your pending requests"})]})]}),$&&s.jsx("div",{className:"mb-6 max-w-md mx-auto",children:s.jsx(m,{message:$})}),k.length>0?s.jsx("div",{className:"grid justify-items-center grid-cols-1 md:grid-cols-2 gap-6 mb-10 md:mb-20 mt-10",children:k.map((e=>s.jsx(g,{className:"cursor-pointer w-full",onClick:()=>K(e),children:s.jsxs(p,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"w-16 h-16 bg-primary-light rounded-full flex items-center justify-center mr-4",children:s.jsx(d,{className:"w-8 h-8 text-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-semibold",children:[e.name||"Unknown stable name"," "]}),s.jsx("p",{className:"text-sm ",children:e.type||"Unknown stable type"})]})]}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Your role:"}),s.jsx("span",{className:"font-medium text-primary",children:v(e.userRole)})]}),e.county&&s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Stable county:"}),s.jsx("span",{className:"font-medium",children:e.county})]})]}),s.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[s.jsx(j,{type:"primary",className:"w-full",onClick:t=>{t.stopPropagation(),K(e)},children:"Select this stable"}),e.userRole!==u.MANAGER&&s.jsx(j,{type:"warning",className:"w-full mt-2",onClick:t=>W(e,"leave",t),disabled:D,children:"Leave stable"}),e.userRole===u.MANAGER&&s.jsx(j,{type:"danger",className:"w-full mt-2",onClick:t=>W(e,"delete",t),disabled:D,children:"Delete stable"})]})]})},e.id)))}):s.jsx("div",{className:"text-center py-10",children:s.jsx("div",{className:"w-20 h-20 bg-primary-light rounded-full flex items-center justify-center mx-auto",children:s.jsx(d,{className:"w-10 h-10 text-primary"})})}),s.jsxs("div",{className:"mt-10 md:mt-0 max-w-md mx-auto",children:[null===L&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg text-center mb-6",children:"Explore new stables"}),s.jsxs("div",{className:"space-y-3 flex flex-col justify-center items-center",children:[s.jsx(j,{type:"primary",className:"w-9/10 max-w-md",onClick:()=>{O("create"),setTimeout((()=>{F({setFocus:!0,block:"start",behavior:"smooth",delay:50,focusSelector:'input[name="stableName"]'})}),10)},"aria-controls":"create-stable-form","aria-expanded":"create"===L,children:"New stable"}),s.jsx(j,{type:"secondary",className:"w-9/10 max-w-md",onClick:()=>O("join"),children:"Search for existing stable"})]})]}),"create"===L&&s.jsx("div",{ref:U,id:"create-stable-form","aria-labelledby":"create-stable-heading",children:s.jsx(x,{formMethods:J,onSubmit:async e=>{const t=await Q(e);t.success&&t.stable&&(sessionStorage.removeItem("isFirstLogin"),sessionStorage.setItem("newStableCreated","true"),window.location.href="/select-stable")},onCancel:X,isLoading:z,loadingState:P,error:G,message:H})}),"join"===L&&s.jsx(b,{formMethods:J,onCancel:X,isLoading:z,loadingState:P,error:G,message:H})]})]}),s.jsx(y,{isOpen:Y.isOpen,onClose:_,onConfirm:async()=>{const{stable:e,action:t}=Y;if(e&&t)try{V(!0);let s=!1;"delete"===t?s=await M(e.id):"leave"===t&&(s=await B(e.id)),s&&(E.current&&clearTimeout(E.current),I(i("delete"===t?`Stable "${e.name}" was successfully deleted.`:`You have successfully left "${e.name}".`)),E.current=setTimeout((()=>{I(null),E.current=null}),3e3),await R())}catch(s){I({type:"error",text:s.message||`Failed to ${Y.action} stable`})}finally{V(!1),_()}},loading:D,title:ee.title||"",confirmButtonText:ee.confirmText||"Confirm",confirmButtonType:ee.buttonType||"primary",icon:s.jsx(h,{size:70,backgroundColor:ee.iconBg||"bg-primary",iconColor:"text-white"}),children:s.jsx("p",{className:"text-center mb-4",children:ee.message||"Are you sure you want to perform this action?"})})]})},v=e=>{switch(e){case 0:return"Owner";case 1:return"Admin";default:return"Member"}};export{N as default};
