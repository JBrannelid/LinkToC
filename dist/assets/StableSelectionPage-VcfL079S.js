import{e as z,u as G,f as J,h as _,d as B,j as e,L as Q,M as W,R as O,C as K,i as X,B as d,U,k as Z}from"./index-C0FfkOcl.js";import{r,u as ee}from"./vendor-router-BURTDQSf.js";import{H as te}from"./HandRaisedIcon-C6cWWIob.js";import{S as F,J as se}from"./JoinStableForm-HlQU7VTx.js";import{u as ae,C as ne}from"./useStableOnboarding-CeQT5EpI.js";import{F as re}from"./FormMessage-BcmBGiAa.js";import"./vendor-react-DavUf6mE.js";import"./vendor-forms-DlkW-UdB.js";import"./LocationPinIcon-Cg1tiP3E.js";const le=()=>{const a=r.useRef(null),l=r.useCallback((o={})=>{const{setFocus:u=!0,block:g="start",behavior:h="smooth",delay:p=100}=o;a.current&&setTimeout(()=>{if(a.current.scrollIntoView({behavior:h,block:g}),u){const x=a.current.querySelector('input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])');x?x.focus():(a.current.setAttribute("tabindex","-1"),a.current.focus(),a.current.removeAttribute("tabindex"))}},p)},[]);return{elementRef:a,scrollIntoView:l}},pe=()=>{const{changeStable:a}=z(),{user:l}=G(),o=ee(),{stables:u,loading:g,loadingState:h,refetch:p}=J(),{deleteStable:x,leaveStable:I}=_(),f=r.useRef(null),[b,y]=r.useState(null),[N,i]=r.useState(null),{elementRef:P,scrollIntoView:$}=le(),[j,w]=r.useState(!1),[c,S]=r.useState({isOpen:!1,stable:null,action:null}),V=async()=>{const{stable:t,action:s}=c;if(!(!t||!s))try{w(!0);let n=!1;s==="delete"?n=await x(t.id):s==="leave"&&(n=await I(t.id)),n&&(f.current&&clearTimeout(f.current),i(B(s==="delete"?`Stable "${t.name}" was successfully deleted.`:`You have successfully left "${t.name}".`)),f.current=setTimeout(()=>{i(null),f.current=null},3e3),await p())}catch(n){console.error(`Error ${c.action} stable:`,n),i({type:"error",text:n.message||`Failed to ${c.action} stable`})}finally{w(!1),A()}},{loading:v,error:C,message:k,loadingState:T,formMethods:R,handleCreateStable:D}=ae();r.useEffect(()=>{if(location.state?.message){i(B(location.state.message));const t=setTimeout(()=>{i(null)},5e3);return o(location.pathname,{replace:!0,state:{}}),()=>clearTimeout(t)}},[o]);const E=(t,s,n)=>{n.stopPropagation(),S({isOpen:!0,stable:t,action:s})},A=()=>{S({isOpen:!1,stable:null,action:null})},M=t=>{sessionStorage.getItem("newStableCreated"),a(t.id,t.name)&&o(O.HOME)},H=async t=>{const s=await D(t);s.success&&s.stable&&(sessionStorage.removeItem("isFirstLogin"),sessionStorage.setItem("newStableCreated","true"),window.location.href="/select-stable")},L=()=>{y(null)},Y=()=>{y("create"),setTimeout(()=>{$({setFocus:!0,block:"start",behavior:"smooth",delay:50,focusSelector:'input[name="stableName"]'})},10)};if(g)return e.jsxs("div",{className:" bg-background flex flex-col items-center justify-center",children:[e.jsx(Q,{size:"large",className:"text-primary mb-4"}),e.jsx("p",{className:"text-gray-600",children:h.getMessage()})]});const q=l?.firstName&&l?.lastName?`${l.firstName} ${l.lastName}`.trim():"Unknown User",m=(()=>{const{stable:t,action:s}=c;return s==="delete"?{title:`Delete stable "${t?.name||""}"?`,confirmText:"Delete",buttonType:"danger",iconBg:"bg-error-500",message:"This action cannot be undone. All data associated with this stable will be permanently deleted."}:s==="leave"?{title:`Leave stable "${t?.name||""}"?`,confirmText:"Leave",buttonType:"warning",iconBg:"bg-warning-400",message:"Are you sure you want to leave this stable? You'll need to send another invite to join the stable again."}:{}})();return e.jsxs("div",{className:"flex flex-col bg-background pb-35 lg:pb-0 overflow-y-auto",children:[e.jsx("div",{className:"bg-primary-light lg:bg-background lg:hidden",children:e.jsx(W,{title:"Select Stable",showCloseBtn:!1})}),e.jsxs("div",{className:"px-4 py-4 mx-auto md:pt-10 lg:pt-15",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"text-xl md:text-2xl mb-2",children:["Welcome ",q,"!"]}),e.jsxs("p",{className:"text-gray pt-5",children:["Choose a stable to work with today, explore new ones, or"," ",e.jsx("span",{className:"text-primary cursor-pointer hover:underline font-semibold",onClick:()=>o(O.STABLE_REQUESTS),children:"check your pending requests"})]})]}),N&&e.jsx("div",{className:"mb-6 max-w-md mx-auto",children:e.jsx(re,{message:N})}),u.length>0?e.jsx("div",{className:"grid justify-items-center grid-cols-1 md:grid-cols-2 gap-6 mb-10 md:mb-20 mt-10",children:u.map(t=>e.jsx(K,{className:"cursor-pointer w-full",onClick:()=>M(t),children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-light rounded-full flex items-center justify-center mr-4",children:e.jsx(F,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[t.name||"Unknown stable name"," "]}),e.jsx("p",{className:"text-sm ",children:t.type||"Unknown stable type"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Your role:"}),e.jsx("span",{className:"font-medium text-primary",children:oe(t.userRole)})]}),t.county&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Stable county:"}),e.jsx("span",{className:"font-medium",children:t.county})]})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[e.jsx(d,{type:"primary",className:"w-full",onClick:s=>{s.stopPropagation(),M(t)},children:"Select this stable"}),t.userRole!==U.MANAGER&&e.jsx(d,{type:"warning",className:"w-full mt-2",onClick:s=>E(t,"leave",s),disabled:j,children:"Leave stable"}),t.userRole===U.MANAGER&&e.jsx(d,{type:"danger",className:"w-full mt-2",onClick:s=>E(t,"delete",s),disabled:j,children:"Delete stable"})]})]})},t.id))}):e.jsx("div",{className:"text-center py-10",children:e.jsx("div",{className:"w-20 h-20 bg-primary-light rounded-full flex items-center justify-center mx-auto",children:e.jsx(F,{className:"w-10 h-10 text-primary"})})}),e.jsxs("div",{className:"mt-10 md:mt-0 max-w-md mx-auto",children:[b===null&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-center mb-6",children:"Explore new stables"}),e.jsxs("div",{className:"space-y-3 flex flex-col justify-center items-center",children:[e.jsx(d,{type:"primary",className:"w-9/10 max-w-md",onClick:Y,"aria-controls":"create-stable-form","aria-expanded":b==="create",children:"New stable"}),e.jsx(d,{type:"secondary",className:"w-9/10 max-w-md",onClick:()=>y("join"),children:"Search for existing stable"})]})]}),b==="create"&&e.jsx("div",{ref:P,id:"create-stable-form","aria-labelledby":"create-stable-heading",children:e.jsx(ne,{formMethods:R,onSubmit:H,onCancel:L,isLoading:v,loadingState:T,error:C,message:k})}),b==="join"&&e.jsx(se,{formMethods:R,onCancel:L,isLoading:v,loadingState:T,error:C,message:k})]})]}),e.jsx(Z,{isOpen:c.isOpen,onClose:A,onConfirm:V,loading:j,title:m.title||"",confirmButtonText:m.confirmText||"Confirm",confirmButtonType:m.buttonType||"primary",icon:e.jsx(te,{size:70,backgroundColor:m.iconBg||"bg-primary",iconColor:"text-white"}),children:e.jsx("p",{className:"text-center mb-4",children:m.message||"Are you sure you want to perform this action?"})})]})},oe=a=>{switch(a){case 0:return"Owner";case 1:return"Admin";case 2:return"Member";default:return"Member"}};export{pe as default};
