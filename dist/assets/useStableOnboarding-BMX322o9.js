import{d as e,r as t}from"./vendor-react-a0IVf7AC.js";import{a as s,h as a,Q as r,T as l,V as c,k as n}from"./form-components-Dej4WxZX.js";const o=()=>{const{user:o}=s(),{changeStable:u}=a(),i=e({defaultValues:{stableName:"",streetAddress:"",postCode:"",county:"",typeOfStable:"Private Stable",stableBoxes:""},mode:"onChange"}),[b,d]=t.useState("welcome"),[m,S]=t.useState(!1),[y,p]=t.useState("create"),[f,g]=t.useState(null),[x,h]=t.useState({type:"",text:""}),[v,C]=t.useState(!0);t.useEffect((()=>{(null==o?void 0:o.id)&&(async()=>{try{if("true"===sessionStorage.getItem("isFirstLogin"))return void C(!0);const e=await n.getUserStables(o.id);C(0===e.length)}catch(e){C(!0)}})()}),[o]),t.useEffect((()=>{g(null),h({type:"",text:""})}),[b]);const N=t.useCallback((e=>{d(e),g(null),h({type:"",text:""})}),[]),k=t.useCallback((async e=>{if(!e.stableName||!e.stableName.trim())return h({type:"error",text:"Stable Name is required"}),{success:!1};S(!0),p("create"),g(null),h({type:"",text:""});try{const t={stableName:e.stableName.trim(),streetAddress:e.streetAddress,postCode:e.postCode,county:e.county,typeOfStable:e.typeOfStable,stableBoxes:parseInt(e.stableBoxes,10)||0},s=await r.createStable(t);if(s&&s.isSuccess){const e=s.value;return h({type:"success",text:s.message||"Stable created successfully."}),{success:!0,stable:e,message:s.message}}{const e=l({type:"server",message:(null==s?void 0:s.message)||"Unavailable to create stable."}).text;return g(e),{success:!1,error:e}}}catch(t){const e=l(t,{defaultMessage:"An error occurred while creating the stable."}).text;return g(e),{success:!1,error:e}}finally{S(!1)}}),[]),w=t.useCallback((async(e,t)=>{if(!e)return g("Invalid stable selection"),{success:!1};S(!0),p("update"),g(null);try{return u(e,t),{success:!0}}catch(s){return g(l(s).text),{success:!1,error:l(s).text}}finally{S(!1)}}),[u]);return{currentStep:b,isFirstLogin:v,loading:m,error:f,message:x,loadingState:c(m,y),formMethods:i,navigateToStep:N,handleCreateStable:k,handleJoinStable:w,submitStableForm:e=>k(e)}};export{o as u};
