import{j as e,C as p,y as b,b as j,e as N,l as v,L as S,m as g,M as w,B as C,R as H}from"./index-B8Zmxeox.js";import{r as a,e as I,u as T}from"./vendor-router-BURTDQSf.js";import{C as k,S as L,a as E}from"./StableInfo--ZhMnBRc.js";import{u as P,a as M,f as O,b as R}from"./useHorseProfile-DIb0eCtm.js";import U from"./horseService-WFSULxac.js";import"./vendor-react-DavUf6mE.js";import"./vendor-forms-DlkW-UdB.js";import"./LocationPinIcon-F9Gq7Frr.js";const A=({horse:t,onClick:d})=>{const n=t?.id||t?.horseId||t?.HorseId,{horse:o,loading:m}=P(n),l=o||t,i=l?.name||"Unknown Horse",x=M(l),h=l?.color||"",c=l?.breed||"",u=l?.age||"",r=u?O(u):"";return m&&n?e.jsx(p,{className:"cursor-pointer",onClick:d,children:e.jsxs("div",{className:"p-2 flex flex-col",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-24 h-24 mb-2 rounded-full overflow-hidden border-2 border-primary lg:w-full lg:h-30 lg:rounded-md animate-pulse bg-gray-200"})}),e.jsx(b,{className:"text-xs !text-start",children:"Loading..."})]})}):e.jsx(p,{className:"cursor-pointer",onClick:d,children:e.jsxs("div",{className:"p-2 flex flex-col",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-24 h-24 mb-2 rounded-full overflow-hidden border-2 border-primary lg:w-full lg:h-30 lg:rounded-md",children:e.jsx("img",{src:x,alt:R(l),className:"w-full h-full object-cover",loading:"lazy"})})}),e.jsx(b,{className:"text-xs !text-start",children:i}),e.jsxs(k,{className:"text-xs !text-start",children:[h&&e.jsx("p",{children:h}),c&&e.jsx("p",{children:c}),r&&e.jsx("p",{children:r})]})]})})},B=t=>{const[d,n]=a.useState([]),[o,m]=a.useState(!0),[l,i]=a.useState(null),[x,h]=a.useState("fetch"),c=a.useCallback(async()=>{if(!t)return n([]),m(!1),!1;m(!0),h("fetch");try{const r=await U.getHorsesWithOwnersByStable(t);return n(r||[]),i(null),!0}catch(r){return r.status===404||r.message?.includes("NOT FOUND_404")?(console.warn("No horses found for this stable - setting empty array"),n([]),i(null)):(console.error("Error fetching stable horses:",r),i(r.message||"Failed to retrieve horses")),!1}finally{m(!1)}},[t]);a.useEffect(()=>{c()},[c]);const u=j(o,x);return{horses:d,loading:o,error:l,loadingState:u,refreshHorses:c}};function J(){const{stableId:t}=I(),{currentStable:d}=N(),n=T(),[o,m]=a.useState(""),l=a.useMemo(()=>t||d?.id,[t,d?.id]),{horses:i,loading:x,loadingState:h}=B(l),c=a.useMemo(()=>{if(!i.length)return[];if(!o.trim())return i;const s=o.toLowerCase();return i.filter(f=>(f.horseName?.toLowerCase()||"").includes(s))},[i,o]),u=a.useCallback(s=>{m(s)},[]),r=a.useCallback(s=>{n(v(H.HORSE_PROFILE,{horseId:s}))},[n]),y=a.useMemo(()=>e.jsxs("div",{className:"flex items-center justify-center h-screen",children:[e.jsx(S,{size:"medium",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:h?.getMessage()})]}),[h]);return x?y:e.jsxs(g.div,{className:"flex flex-col min-h-screen bg-background pb-35 overflow-y-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("div",{className:"bg-primary-light lg:bg-background",children:e.jsx(w,{})}),e.jsx(L,{stableId:l,searchTerm:o,onSearchChange:u,searchPlaceholder:"Search..."}),e.jsxs("div",{className:"px-5 py-3 md:px-10 lg:px-40 xl:px-60 pt-2 lg:pt-10",children:[e.jsx("div",{className:"mb-5 border-t border-b border-gray py-5 lg:hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search...",className:"w-full px-10 py-2 border border-primary rounded-lg focus:outline-none focus:ring-1 focus:ring-primary",value:o,onChange:s=>m(s.target.value)}),e.jsx("div",{className:"absolute inset-y-0 left-3 flex items-center",children:e.jsx(E,{className:"w-5 h-5 text-primary",strokeWidth:3})})]})}),e.jsx(g.div,{className:"mb-6 flex justify-center lg:hidden",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.2},children:e.jsx(C,{type:"secondary",className:"w-full max-w-sm",onClick:()=>r(d?.id),children:"My horse"})}),e.jsx(g.div,{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-5",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.08}}},children:c.map((s,f)=>e.jsx(g.div,{variants:{hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1}},whileHover:{y:-2,scale:1.02,boxShadow:"0 4px 20px rgba(0,0,0,0.08)"},whileTap:{scale:.98},transition:{duration:.2},children:e.jsx(A,{horse:s,onClick:()=>r(s.id||s.horseId||s.HorseId)})},s.id??`horse-${f}`))}),c.length===0&&e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray",children:"No horses found"})})]})]})}export{J as default};
