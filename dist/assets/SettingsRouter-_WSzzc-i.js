import{j as s,u as $,M as q,a as U,B as g,c as H,d as A,R as L,g as Z,V as O,S as re,E as V,T as le,X as oe,J as _,L as G,n as Y,P as K,k as J,e as ie,Y as ne,Z as ce,$ as de,a0 as X,a1 as Q,a2 as W,a3 as me,H as ue}from"./index-uCdg3-W8.js";import{r as c,u as T}from"./vendor-router-BURTDQSf.js";import{P as ee}from"./PenIcon-BV5Oi6ts.js";import{u as he,a as fe,F as pe}from"./vendor-forms-DlkW-UdB.js";import{F as xe}from"./FormMessage-DDtpDkQr.js";import{H as ge}from"./HandRaisedIcon-8TPnBXoX.js";import"./vendor-react-DavUf6mE.js";const we=({size:o=24,backgroundColor:i="bg-error-500",iconColor:r="text-white",className:l="",strokeWidth:u=1.5,...d})=>{const a=Math.floor(o*.6);return s.jsx("div",{className:`${i} ${r} flex items-center justify-center rounded-full overflow-hidden ${l}`,style:{width:o,height:o},...d,children:s.jsxs("svg",{width:a,height:a,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M16 13v-2H7V8l-5 4 5 4v-3z",strokeWidth:u}),s.jsx("path",{d:"M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z",strokeWidth:u})]})})},be=({onCancel:o})=>{const[i,r]=c.useState(1),[l,u]=c.useState(!1),[d,a]=c.useState({type:"",text:""}),E=T(),{formState:{errors:S},watch:w,handleSubmit:N,reset:P,register:n}=he(),h=w("new_password"),{user:b,logout:k}=$(),p=async t=>{u(!0),a({type:"",text:""});try{await H.login({email:b.email,password:t.current_password}),r(2)}catch{a({type:"error",text:"Incorrect password. Please try again."})}finally{u(!1)}},j=async t=>{u(!0),a({type:"",text:""});try{(await H.changePassword({userId:b.id,newPassword:t.new_password,confirmPassword:t.confirm_password}))?.isSuccess&&(a(A("Password updated successfully. Logging you out for security...")),setTimeout(async()=>{await k(),E(L.LOGIN)},1500))}catch(y){a(Z(y,{defaultMessage:"Unable to update password. Please try again."}))}finally{u(!1)}},x=()=>{P(),r(1),a({type:"",text:""}),o()};return s.jsx("div",{className:"fixed inset-0 z-50 bg-white md:bg-black/40 shadow-md flex flex-col md:items-center md:justify-center",children:s.jsxs("div",{className:"w-full h-full md:max-h-8/10 md:w-xl overflow-y-auto bg-background shadow-md rounded flex flex-col relative",children:[s.jsx(q,{title:"Change Password",showCloseBtn:!0,onCloseClick:x,className:"bg-primary-light"}),s.jsx("div",{className:"p-6",children:s.jsxs("form",{id:"password-change-form",onSubmit:t=>t.preventDefault(),children:[i===1&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-4",children:s.jsx(U,{name:"current_password",label:"Current Password",type:"password",labelPosition:"above",autoComplete:"current-password",showPasswordToggle:!0,validation:{required:"Please enter your current password"}})}),d.text&&s.jsx("div",{className:`mb-4 p-3 rounded ${d.type==="success"?"bg-primary-light text-primary":"bg-red-50 text-error-600"}`,children:s.jsx("p",{children:"Oops! Thatâ€™s not quite the magic word."})}),s.jsx("p",{className:"text-sm mb-4",children:"For your security, please verify your current password to continue."}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(g,{type:"secondary",onClick:x,disabled:l,children:"Cancel"}),s.jsx(g,{type:"primary",onClick:N(p),loading:l,disabled:l,children:"Continue"})]})]}),i===2&&s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-sm mb-4",children:"Create a strong password with at least 8 characters."}),s.jsx("div",{className:"mb-4",children:s.jsx(U,{name:"new_password",label:"New Password",type:"password",labelPosition:"above",autoComplete:"new-password",showPasswordToggle:!0,validation:{required:"Please enter your new password",minLength:{value:8,message:"Needs 8+ chars, 1 big letter & 1 special sign"}}})}),s.jsx("div",{className:"mb-4",children:s.jsx(U,{name:"confirm_password",label:"Confirm New Password",type:"password",labelPosition:"above",autoComplete:"new-password",showPasswordToggle:!0,validation:{required:"Please confirm your new password",validate:t=>t===h||"Passwords do not match"}})}),d.text&&s.jsx("div",{className:`mb-4 p-3 rounded ${d.type==="success"?"bg-primary-light text-primary":"bg-red-50 text-error-600"}`,children:d.text}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(g,{type:"secondary",onClick:()=>r(1),disabled:l,children:"Back"}),s.jsx(g,{type:"primary",onClick:N(j),loading:l,disabled:l,children:"Update Password"})]})]})]})})]})})},je=({initialImageUrl:o="",onImageUploaded:i,onError:r,label:l="Choose Image",className:u="",placeholder:d="/images/profilePlaceholder.jpg",userId:a=null})=>{const[E,S]=c.useState(o||d),[w,N]=c.useState(!1),[P,n]=c.useState(!1),h=c.useRef(null),b=()=>{h.current?.click()},k=async p=>{const j=p.target.files?.[0];if(!j)return;const x=re(j,O);if(!x.valid){x.error.includes("too large")?r?.("File too large"):r?.("Invalid file");return}r?.(""),N(!0),n(!1);try{let t=null;if(a)try{const f=await V.getById(a);f?.value?.profilePicture&&(t=f.value.profilePicture)}catch{console.warn("Couldn't retrieve old profile picture:",e)}const{uploadFile:y}=window.__fileUploadContext||{};if(!y)throw new Error("File upload service not available. Make sure FileUploadProvider is in your component tree.");const C=await y(j,a?"profile-picture":"image",a);if(!C.success)throw new Error(C.error||"Failed to upload image");const F=C.blobName.split("/").pop();if(a){const f=await V.setProfilePicture(a,F);if(!f||!f.isSuccess)throw new Error("Failed to update profile picture");if(t&&t!==F)try{const m=await le(t,a);m.success||console.warn("Failed to delete old profile picture:",m.error)}catch(m){console.warn("Error attempting to delete old profile picture:",m)}n(!0);try{const m=`profile-pictures/${a}/${F}`,M=await oe(m);S(M?`${M}&t=${Date.now()}`:d)}catch(m){console.warn("Could not get SAS URL for image preview:",m),S(d)}}return await new Promise(f=>setTimeout(f,500)),i&&i({url:C.url,blobName:C.blobName,fileName:F,type:j.type,size:j.size}),C}catch(t){return console.error("Upload error:",t),r?.(t.message||"Failed to upload image"),{success:!1,error:t.message}}finally{N(!1)}};return s.jsxs("div",{className:`${u}`,children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(g,{type:"secondary",onClick:b,disabled:w,loading:w,className:"text-sm",children:w?"Uploading...":l}),P&&s.jsx("div",{className:"text-green-600 text-sm font-medium",children:"Image updated successfully!"}),s.jsx("input",{type:"file",ref:h,onChange:k,accept:O.join(","),className:"hidden"})]}),s.jsx("div",{className:"relative"})]})},ye=({onClose:o,onSuccess:i,userData:r})=>{const{user:l,verifyToken:u}=$(),{deleteAccount:d}=_(),a=l?.id,{userData:E,loading:S,loadingState:w,updateUserData:N,fetchAndUpdateUserData:P}=_(a),n=r||E||l,[h,b]=c.useState(!1),[k,p]=c.useState({type:"",text:""}),[j,x]=c.useState(!1),[t,y]=c.useState(!1),[I,C]=c.useState(""),[F,f]=c.useState(0),m=fe({defaultValues:{firstName:n?.firstName||"",lastName:n?.lastName||"",phoneNumber:n?.phoneNumber||""}});c.useEffect(()=>{n&&m.reset({firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||"",phoneNumber:n.phoneNumber||""})},[n,m]);const M=async D=>{try{b(!0),p({type:"",text:""});const R={id:a,...D},B=await N(R);if(!B.success)throw new Error(B.error||"Profile update failed");await P(),await u(),p(A("Profile successfully updated")),i&&i()}catch(R){console.error("Error updating profile:",R),p(Z(R,{defaultMessage:"Could not update profile"}))}finally{b(!1)}},ae=async()=>{b(!0),await d(a)||x(!1),b(!1)};if(S&&!n)return s.jsxs("div",{className:"py-2 text-gray flex items-center justify-center",children:[s.jsx(G,{size:"medium",className:"text-gray"}),s.jsx("p",{children:w.getMessage()})]});const z=n||l,te=Y(z);return s.jsx("div",{className:"fixed inset-0  bg-white md:bg-black/40 shadow-md flex flex-col md:items-center md:justify-center lg:z-0 z-110",children:s.jsxs("div",{className:"w-full h-full md:max-h-8/10 md:w-xl overflow-y-auto bg-white shadow-md rounded flex flex-col relative",children:[s.jsxs("div",{className:"bg-primary-light pb-5",children:[s.jsx(q,{showChevronLeftBtn:!0,onChevronClick:o,className:"bg-primary-light"}),s.jsx("h1",{className:"text-center text-xl uppercase mt-5",children:"Edit profile"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-35 md:pb-5",children:s.jsx(pe,{...m,children:s.jsxs("div",{children:[s.jsxs("div",{className:"bg-white rounded-lg p-2 mb-4 flex flex-col border-light border-2 shadow-md",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-2 border-light",children:s.jsx(K,{user:z,className:"w-full h-full",size:"rounded",alt:`Profile image of ${te}`},F)}),s.jsx("div",{className:"mr-5 ",children:s.jsx(je,{onImageUploaded:async()=>{f(D=>D+1),await P(),await u(),p(A("Profile picture successfully updated"))},onError:C,label:"Choose image",displayImagePreview:!0,userId:a})})]}),s.jsx(xe,{message:k}),I&&s.jsx("p",{className:"text-sm text-error-500 text-end mr-5",children:I})]}),s.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 border-primary-light border-1 shadow-md",children:[s.jsx("div",{className:"flex justify-between items-center mb-5",children:s.jsx("h2",{className:"font-bold",children:"Personal Information"})}),s.jsxs("div",{className:"space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("div",{children:s.jsx(U,{label:"First name",name:"firstName",labelPosition:"above",validation:{required:"First name is required"}})}),s.jsx("div",{children:s.jsx(U,{label:"Last name",name:"lastName",labelPosition:"above",validation:{required:"Last name is required"}})})]}),s.jsx("div",{className:"space-y-2",children:s.jsx(U,{label:"Phone number",name:"phoneNumber",labelPosition:"above",validation:{pattern:{value:/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/i,message:"Invalid phone number format"}}})}),s.jsx("div",{className:"space-y-2",children:s.jsx(U,{label:"Email",name:"email",labelPosition:"above",readOnly:!0,inputClassName:"bg-gray-100 cursor-not-allowed",validation:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}})})]})]}),s.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 border-primary-light border-1 shadow-md flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center w-full",children:[s.jsx("h2",{className:"font-bold",children:"Update password"}),!t&&s.jsx(g,{variant:"icon","aria-label":"Update password fields",onClick:()=>y(!t),children:s.jsx(ee,{className:"w-7 h-7 text-primary"})})]}),t&&s.jsx(be,{onCancel:()=>y(!1),user:n||l,onSuccess:()=>{y(!1),p(A("Password updated"))}})]}),s.jsx("div",{className:"flex justify-center",children:s.jsxs("div",{className:" w-9/10 sm:w-8/10",children:[s.jsx(g,{type:"primary",onClick:m.handleSubmit(M),loading:h,disabled:h,className:"w-full mb-5",children:"Save Changes"}),s.jsx(g,{type:"danger",onClick:()=>x(!0),disabled:h,className:"w-full",children:"Delete Account"})]})})]})})}),s.jsx(J,{isOpen:j,onClose:()=>x(!1),onConfirm:ae,loading:h,title:"Do you want to delete the account?",icon:s.jsx(ge,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"})})]})})},v=({label:o,onClick:i,icon:r})=>s.jsxs(g,{type:"secondary",className:"w-full text-left justify-start px-4",onClick:i,children:[r&&s.jsx("span",{className:"mr-2",children:r}),o]}),se=({title:o="Settings",renderMenuItems:i,renderAdditionalContent:r,showProfileEdit:l=!0})=>{const{logout:u,user:d}=$(),{currentStable:a,getCurrentStableRole:E}=ie(),S=E(),w=T(),[N,P]=c.useState(!1),[n,h]=c.useState(!1),[b,k]=c.useState(!1),{userData:p,userLoading:j,userError:x,loadingState:t,fetchAndUpdateUserData:y}=_(),I=()=>{y(),h(!1)};if(j)return s.jsxs("div",{className:"flex-1 flex items-center justify-center",children:[s.jsx(G,{size:"medium",className:"text-gray"}),s.jsx("p",{className:"ml-2",children:t.getMessage()})]});const C=()=>{k(!0)},F=async()=>{try{P(!0),await u(),w(L.LOGIN)}catch(M){console.error("Logout error:",M)}finally{P(!1),k(!1)}},f=p||d,m=Y(f);return s.jsxs("div",{className:"flex flex-col min-h-screen bg-background pb-35 lg:p-0 overflow-y-hidden ",children:[s.jsx("div",{className:"bg-primary-light lg:bg-background border-b-1 border-light ",children:s.jsx(q,{title:o})}),s.jsxs("div",{className:"flex-1 px-4 py-6 space-y-4 md:px-50 xl:px-100",children:[s.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center drop-shadow-lg",children:[s.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden mr-4",children:s.jsx(K,{user:f,className:"w-full h-full",size:"rounded"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-medium",children:m}),s.jsx("p",{className:"text-grey",children:f?.email||"No email address registered"})]}),l&&s.jsx(g,{onClick:()=>h(!0),className:"p-2 text-primary",variant:"icon","aria-label":"Edit user profile",children:s.jsx(ee,{className:"w-9 h-9"})})]}),r&&r({currentRole:S,currentStable:a}),x&&s.jsx("div",{className:"bg-red-50 border-l-4 border-error-400 p-4 text-error-600",children:x}),s.jsx("div",{className:"space-y-4",children:i({setShowUserEditProfileForm:h,navigate:w,currentRole:S,currentStable:a})}),s.jsx("div",{className:"pt-8 space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 justify-items-center gap-5",children:[s.jsx(g,{type:"primary",className:"w-9/10",onClick:()=>ne(w,L),children:"Change stable"}),s.jsx(g,{type:"secondary",className:"w-9/10",onClick:C,loading:N,children:"Log out"})]})}),s.jsx(J,{isOpen:b,onClose:()=>k(!1),onConfirm:F,loading:N,title:"Do you want to log out?",confirmButtonText:"Log out",confirmButtonType:"danger",icon:s.jsx(we,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"})})]}),n&&s.jsx(ye,{onClose:()=>h(!1),onSuccess:I,userData:p})]})},ve=()=>{const o=T(),i=({setShowUserEditProfileForm:l})=>s.jsxs(s.Fragment,{children:[s.jsx(v,{label:"Edit Profile",onClick:()=>l(!0)}),s.jsx(v,{label:"Manage Horses",onClick:()=>ce(o,L)}),s.jsx(v,{label:"Manage Stables",onClick:()=>de(o,L)}),s.jsx(v,{label:"Terms of Service",onClick:X}),s.jsx(v,{label:"Support",onClick:Q}),s.jsx(v,{label:"Privacy Policy",onClick:W})]}),r=({currentStable:l})=>s.jsx("div",{className:"bg-white rounded-lg p-4 flex items-center drop-shadow-lg border border-primary",children:s.jsxs("h3",{className:"text-primary text-sm",children:["You are the admin of ",l?.name,"."]})});return s.jsx(se,{title:"Settings",renderMenuItems:i,renderAdditionalContent:r})},Ne=()=>{const o=T(),i=({setShowUserEditProfileForm:r})=>s.jsxs(s.Fragment,{children:[s.jsx(v,{label:"Edit Profile",onClick:()=>r(!0)}),s.jsx(v,{label:"Stable Requests",onClick:()=>me(o,L)}),s.jsx(v,{label:"Terms of service",onClick:X}),s.jsx(v,{label:"Support",onClick:Q}),s.jsx(v,{label:"Privacy Policy",onClick:W})]});return s.jsx(se,{title:"Settings",renderMenuItems:i})},Me=()=>{const{hasAdminAccess:o}=ue();return o()?s.jsx(ve,{}):s.jsx(Ne,{})};export{Me as default};
