import{j as e,e as F,M as q,F as X,a as H,B as y,k as G,n as ee,o as se,L as E,P as U,p as S,q as R,U as C,u as te,m as V,r as O,s as le,t as ae,v as re,w as ne}from"./index-cpbE97Et.js";import{r as p,e as ie}from"./vendor-router-BURTDQSf.js";import{a as oe}from"./vendor-forms-DlkW-UdB.js";import"./JoinStableForm-BqYu9IxQ.js";import{H as Y}from"./HandRaisedIcon-DAdfcYv9.js";import{M as ce}from"./MessageIcon-CJ5tk-dN.js";import{P as W}from"./PenIcon-xFkDe9yN.js";import"./vendor-react-DavUf6mE.js";import"./FormMessage-h66-qLR8.js";import"./LocationPinIcon-DrBXs3SK.js";const Z=({size:s=24,color:r="currentColor",className:n="",strokeWidth:a=1.5,...x})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",className:n,...x,children:e.jsx("path",{fill:r,d:"M16,6l-13,0c-0.552,0 -1,0.448 -1,1l0,22c0,0.552 0.448,1 1,1l22,0c0.552,0 1,-0.448 1,-1l0,-13c0,-0.552 -0.448,-1 -1,-1c-0.552,-0 -1,0.448 -1,1l0,12c0,0 -20,0 -20,0c0,0 0,-20 0,-20c-0,0 12,0 12,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1Zm-9,19l14,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-14,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm-0,-4l4,0c0.552,-0 1,-0.448 1,-1c-0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,-0 -1,0.448 -1,1c-0,0.552 0.448,1 1,1Zm22.707,-13.293c0.391,-0.39 0.391,-1.024 0,-1.414l-4,-4c-0.39,-0.391 -1.024,-0.391 -1.414,-0l-10,10c-0.14,0.139 -0.235,0.317 -0.274,0.511l-1,5c-0.065,0.328 0.037,0.667 0.274,0.903c0.236,0.237 0.575,0.339 0.903,0.274l5,-1c0.194,-0.039 0.372,-0.134 0.511,-0.274l10,-10Zm-22.707,9.293l4,0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-4,0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Zm0,-4l5,-0c0.552,0 1,-0.448 1,-1c0,-0.552 -0.448,-1 -1,-1l-5,-0c-0.552,0 -1,0.448 -1,1c0,0.552 0.448,1 1,1Z",strokeWidth:a})}),de=({post:s=null,onSubmit:r,onCancel:n,onDelete:a,title:x="New post"})=>{const{currentStable:c,currentUser:d}=F();p.useRef(null);const[o,h]=p.useState(!1),l=oe({defaultValues:{title:"",content:""}});p.useEffect(()=>{s?l.reset({title:s.title||"",content:s.content||""}):l.reset({title:"",content:""})},[s,l]);const i=m=>{const j={...m,id:s?.id,userIdFk:s?.userIdFk||d?.id,stableIdFk:s?.stableIdFk||c?.id,date:s?.date||new Date().toISOString(),isPinned:s?.isPinned||!1};r(j)},f=()=>{h(!0)},u=()=>{s&&s.id&&typeof a=="function"&&(a(s.id),h(!1)),n()};return e.jsx("div",{className:"fixed inset-0 z-50 bg-white md:bg-black/40 shadow-md flex flex-col md:items-center md:justify-center",children:e.jsxs("div",{className:"w-full h-full md:h-auto md:w-xl overflow-y-auto bg-background shadow-md rounded flex flex-col relative",children:[e.jsxs("div",{className:"bg-primary-light pb-5",children:[e.jsx(q,{showCloseBtn:!0,onCloseClick:n,className:"bg-primary-light",render:"left"}),e.jsx("h1",{className:"text-center text-xl uppercase mt-5",children:x})]}),e.jsx("div",{className:"flex flex-col flex-1 px-4 pt-4 pb-6 md:pb-4",children:e.jsxs(X,{methods:l,onSubmit:i,footer:{showFooter:!1},className:"flex flex-col flex-1",children:[e.jsx("div",{className:"bg-white rounded-t-lg border-b border-primary-light",children:e.jsx(H,{name:"title",placeholder:"Title...",inputClassName:"h-12 border-none !rounded-b-0 font-semibold",validation:{required:"Title is required",maxLength:{value:100,message:"Maximum 100 characters"}}})}),e.jsx("div",{className:"bg-white rounded-b-lg flex-grow",children:e.jsx(H,{name:"content",type:"textarea",placeholder:"Description...",inputClassName:"border-none !rounded-t-0 h-full",rows:7,validation:{required:"Content is required"},className:"h-full"})}),e.jsx("div",{className:"mt-4 mb-6 flex justify-end opacity-30"}),e.jsx("div",{className:"w-full flex justify-center mt-auto",children:e.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-md",children:[e.jsx(y,{type:"primary",className:"w-full",onClick:l.handleSubmit(i),children:s?"Update":"Post"}),s&&e.jsx(y,{type:"danger",className:"w-full",onClick:f,children:"Delete"})]})})]})}),e.jsx(G,{isOpen:o,onClose:()=>h(!1),onConfirm:u,title:"Delete this post?",confirmButtonText:"Delete",confirmButtonType:"danger",cancelButtonText:"Cancel",icon:e.jsx(Y,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"}),children:e.jsx("p",{className:"text-center",children:"Are you sure you want to delete this post? This action cannot be undone."})})]})})},me=({count:s,onClick:r})=>e.jsx("div",{className:"flex justify-end items-center text-gray mt-2 pb-2 border-b-1 border-primary cursor-pointer hover:text-primary",onClick:r,children:e.jsxs("span",{className:"text-sm",children:[s," comments"]})}),xe=({size:s=24,color:r="currentColor",strokeWidth:n=2,className:a=""})=>e.jsx("svg",{width:s,height:s,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:e.jsx("path",{d:"M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z",stroke:r,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})}),ue=({onSubmit:s,postId:r,disabled:n=!1})=>{const[a,x]=p.useState(""),{currentUser:c}=F(),d=o=>{o.preventDefault(),a.trim()&&s&&(s(r,a),x(""))};return e.jsxs("form",{onSubmit:d,className:"mt-3 flex",children:[e.jsx(xe,{className:"w-7 h-7 mr-1 text-primary"}),e.jsx("div",{className:"flex-grow bg-light/40 rounded-full",children:e.jsx("input",{type:"text",placeholder:`Comment as ${ee(c)}...`,className:"w-full px-3 py-1 border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary",value:a,onChange:o=>x(o.target.value),disabled:n})})]})},he=({isOpen:s,onClose:r,comments:n=[],postId:a,onCreateComment:x,onDeleteComment:c,loading:d})=>{const{currentUser:o,getCurrentStableRole:h}=F(),[l,i]=p.useState(""),[f,u]=p.useState(null),[m,j]=p.useState(!1),w=h(),P=w===C.ADMIN||w===C.MANAGER;if(!s)return null;const k=t=>{t.preventDefault(),l.trim()&&(x(a,l),i(""))},b=()=>{f&&(c(f.id,a),j(!1),u(null))},I=t=>{(P||t.userId===o?.id)&&(u(t),j(!0))},v=t=>{try{const N=S(t);return R(N,"MM/dd-yy HH:mm")}catch{return"Unknown date"}};return e.jsxs("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-30",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-9/10 md:max-w-5/10 h-7/10 flex flex-col relative",children:[e.jsxs("div",{className:"py-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-2xl font-semibold text-center",children:"Comments"}),e.jsx("button",{onClick:r,className:"absolute top-4 right-4","aria-label":"Close",children:e.jsx(se,{size:30,strokeWidth:2,className:"text-primary "})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 max-h-96",children:d?e.jsxs("div",{className:"flex justify-center items-center h-40",children:[e.jsx(E,{size:"medium"}),e.jsx("p",{className:"ml-2",children:"Loading comments..."})]}):e.jsx("div",{className:"space-y-4",children:n&&n.length>0?n.map((t,N)=>e.jsxs("div",{className:"relative pl-16",children:[e.jsx("div",{className:"absolute left-0 top-2",children:e.jsx(U,{user:{id:t.userId,profilePicture:t.profilePicture,firstName:t.firstName||"",lastName:t.lastName||""},className:"w-12 h-12 rounded-full object-cover border border-light",alt:`${t.firstName||"User"} ${t.lastName||""}'s avatar`,size:"rounded"})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-sm text-gray",children:v(t.commentDate)})}),e.jsxs("div",{className:`border border-gray rounded-lg p-4 ${P||t.userId===o?.id?"hover:bg-light/30 cursor-pointer":""}`,onClick:()=>I(t),children:[e.jsx("div",{className:"flex mb-2",children:e.jsxs("p",{className:"font-bold",children:[t.firstName," ",t.lastName]})}),e.jsx("p",{className:"text-black break-words",children:t.content})]})]},N)):e.jsx("p",{className:"text-center py-8 text-gray",children:"No comments yet"})})}),e.jsx("div",{className:"border-t border-light p-4",children:e.jsxs("form",{onSubmit:k,className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Add a comment...",className:"flex-grow px-4 py-3 border border-light rounded-lg focus:outline-none focus:ring-1 focus:ring-primary",value:l,onChange:t=>i(t.target.value)}),e.jsxs(y,{type:"primary",htmlType:"submit",className:"rounded-lg px-6 py-3",disabled:d||!l.trim(),children:[e.jsx("span",{className:"block md:hidden",children:"+"}),e.jsx("span",{className:"hidden md:block",children:"Comment"})]})]})})]}),e.jsx(G,{isOpen:m,onClose:()=>j(!1),onConfirm:b,title:"Delete Comment",confirmButtonText:"Delete",confirmButtonType:"danger",cancelButtonText:"Cancel",icon:e.jsx(Y,{size:70,backgroundColor:"bg-error-500",iconColor:"text-white"}),children:e.jsx("p",{children:"Are you sure you want to delete this comment? This action cannot be undone."})})]})},fe=({post:s,onEditPost:r,onTogglePin:n,onCreateComment:a,onDeleteComment:x,comments:c,commentLoading:d,fetchComments:o})=>{const{user:h,isLoading:l}=te(),{getCurrentStableRole:i}=F(),[f,u]=p.useState(!1),m=()=>{o&&o(s.id),u(!0)},j=i(),w=j===C.ADMIN||j===C.MANAGER,k=String(h?.id)===String(s.userId)||w,b=w,I=D=>{try{return R(S(D),"yyyy-MM-dd")}catch{return"Unknown date"}},v=D=>{try{return R(S(D),"HH:mm")}catch{return""}},t={id:s.userId,firstName:s.posterFirstName||"Unknown",lastName:s.posterLastName||"",profilePicture:s.profilePicture},N=`${t.firstName} ${t.lastName}`.trim()||"Unknown User",M=()=>{n&&n(s)};if(l)return e.jsxs("div",{className:"flex justify-center p-4",children:[e.jsx(E,{size:"small",className:"text-gray"}),e.jsx("p",{className:"ml-2",children:"Loading..."})]});const A=c&&c[s.id]?c[s.id].length:s.commentCount||0;return e.jsxs(V.div,{className:"bg-background pb-2 md:w-9/10 lg:mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"lg:hidden",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-grey opacity-80 md:text-sm"}),e.jsxs("p",{className:"text-xs text-grey opacity-80 md:text-sm",children:["kl ",v(s.date)]})]}),e.jsxs("div",{className:"bg-white w-full rounded-lg px-6 py-2 pt-3 mb-2 shadow-lg md:hidden",children:[e.jsxs("div",{className:"flex justify-between pb-4",children:[e.jsx("div",{className:"w-10 h-10 md:w-13 md:h-13 lg:w-17 lg:h-17 border-1 border-primary rounded-full overflow-hidden",children:e.jsx(U,{user:t,className:"w-full h-full",alt:`Profile image of ${N}`,fallbackUrl:"/images/userPlaceholderRounded.webp",size:"rounded"})}),b&&e.jsx("div",{onClick:M,className:"cursor-pointer",children:e.jsx(O,{className:`w-8 h-8 ${s.isPinned?"text-primary":"text-primary opacity-20"}`})}),!b&&s.isPinned&&e.jsx(O,{className:"w-8 h-8 text-primary"})]}),e.jsx("h3",{className:"pb-4 text-2xl",children:s.title}),e.jsx("p",{className:"max-w-9/10 text-lg",children:s.content}),e.jsx("p",{className:"text-lg text-grey opacity-80 pt-5",children:N}),e.jsxs("div",{className:"flex justify-end",children:[k&&e.jsx(y,{variant:"icon",className:"text-primary",onClick:()=>r(s),children:e.jsx(W,{size:32})}),e.jsx(y,{variant:"icon",className:"text-primary border-none shadow-none",onClick:()=>m(),children:e.jsx(ce,{size:32})})]})]})]}),e.jsxs("div",{className:"hidden md:block bg-white rounded-lg shadow-lg overflow-hidden lg:mt-4",children:[e.jsxs("div",{className:"px-5 pt-4 pb-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 border border-primary rounded-full overflow-hidden",children:e.jsx(U,{user:t,className:"w-full h-full object-cover",alt:`Profile of ${N}`,size:"rounded"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"font-medium",children:N}),e.jsxs("p",{className:"text-xs text-gray-500",children:[I(s.date)," -",e.jsx("br",{}),"kl"," ",v(s.date)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[k&&e.jsx("div",{className:"flex",children:e.jsx(y,{variant:"icon",className:"text-primary",onClick:()=>r(s),children:e.jsx(W,{size:32})})}),b&&e.jsx("div",{onClick:M,className:"cursor-pointer ml-2",children:e.jsx(O,{size:32,className:`${s.isPinned?"text-primary":"text-primary opacity-20"}`})}),!b&&s.isPinned&&e.jsx(O,{className:" text-primary ml-2",size:32})]})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsx("h3",{className:"md:text-xl mb-3",children:s.title}),e.jsx("p",{className:"mb-4",children:s.content}),s.image&&e.jsx("div",{className:"w-full mb-4",children:e.jsx(U,{src:s.image,alt:"Post image",size:"rounded",className:"w-full h-auto object-cover rounded-lg"})}),e.jsx(me,{count:A,onClick:m}),e.jsx(ue,{onSubmit:a,user:t,postId:s.id,disabled:!a})]})]}),e.jsx(he,{isOpen:f,onClose:()=>u(!1),comments:c?.[s.id]||[],postId:s.id,onCreateComment:a,onDeleteComment:x,loading:d})]})},T=({title:s,posts:r,onEditPost:n,onDeletePost:a,onTogglePin:x,onCreateComment:c,onDeleteComment:d,comments:o,commentLoading:h,fetchComments:l})=>r.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h2",{className:"text-3xl",children:s})}),r.map((i,f)=>e.jsx(fe,{post:i,onEditPost:n,onDeletePost:a,onTogglePin:x,onCreateComment:c,onDeleteComment:d,comments:o,commentLoading:h,fetchComments:l},f))]}),pe=({posts:s,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:c,comments:d,commentLoading:o,fetchComments:h})=>{const l=p.useMemo(()=>{const i={today:[],lastWeek:[],older:[]};if(s.length===0)return i;s.forEach(u=>{try{const m=S(u.date);le(m)?i.today.push(u):ae(m)?i.lastWeek.push(u):i.older.push(u)}catch(m){console.error("Error processing post date:",m),i.older.push(u)}});const f=(u,m)=>re(S(u.date),S(m.date));return i.today.sort(f),i.lastWeek.sort(f),i.older.sort(f),i},[s]);return e.jsxs("div",{className:"py-2",children:[l.today.length>0&&e.jsx(T,{title:"Today",posts:l.today,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:c,comments:d,commentLoading:o,fetchComments:h}),l.lastWeek.length>0&&e.jsx(T,{title:"Last week",posts:l.lastWeek,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:c,comments:d,commentLoading:o,fetchComments:h}),l.older.length>0&&e.jsx(T,{title:"Older posts",posts:l.older,onEditPost:r,onDeletePost:n,onTogglePin:a,onCreateComment:x,onDeleteComment:c,comments:d,commentLoading:o,fetchComments:h})]})};function Pe(){const{stableId:s}=ie(),{currentStable:r,getCurrentStableRole:n,currentUser:a}=F(),[x,c]=p.useState(!1),[d,o]=p.useState(null),h=s||r?.id,l=n(),i=l!==void 0,[f,u]=p.useState(!1),{posts:m,status:{loading:j},loadingState:w,createPost:P,updatePost:k,deletePost:b,togglePinStatus:I,comments:v,commentLoading:t,fetchComments:N,createComment:M,deleteComment:A}=ne(h,a),D=()=>{u(!0)},L=()=>{u(!1)},z=()=>{c(!0),o(null)},Q=g=>{o(g),c(!0)},B=()=>{c(!1),o(null)},_=async g=>{d?await k(g):await P(g),B()},$=async g=>{await b(g)},J=async g=>{try{await I(g.id)}catch(K){console.error("Error toggling pin status:",K)}};return j?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 h-screen",children:[e.jsx(E,{size:"medium",className:"text-gray mb-3"}),e.jsx("p",{className:"text-gray-600 text-center animate-pulse",children:w.getMessage()})]}):e.jsxs("div",{className:"bg-background min-h-screen flex flex-col pb-35",children:[e.jsx("div",{className:"border-b-1 border-light flex justify-center",children:e.jsx(q,{title:"Feed",className:"max-w-6xl mx-auto flex items-center"})}),e.jsxs("div",{className:"flex max-w-5xl mx-auto w-full",children:[e.jsx("div",{className:"flex-1 p-4 md:px-6 lg:w-2/4 mt-8 relative",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(pe,{posts:m,onEditPost:Q,onDeletePost:$,onTogglePin:J,onCreateComment:M,onDeleteComment:A,comments:v,commentLoading:t,fetchComments:N,onCommentsModalOpen:D,onCommentsModalClose:L,className:"bg-white rounded-xl shadow-md"}),m&&m.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 text-center",children:[e.jsx("p",{className:"mb-2",children:"No posts yet"}),i&&e.jsx("button",{onClick:z,className:"text-primary font-medium hover:underline",children:"Create the first post"})]})]})}),e.jsxs(V.div,{className:"hidden md:flex md:flex-col md:w-4/10 lg:w-1/3 p-4 space-y-5 sticky top-58 self-start h-fit",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsx("h3",{className:"font-medium text-lg mb-3",children:"Stable Info"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Stable:"," ",e.jsx("span",{className:"text-primary",children:r?.name||"Your Stable"})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Your role: ","",l===C.USER?e.jsx("span",{className:"text-primary",children:"User"}):l===C.ADMIN?e.jsx("span",{className:"text-primary",children:"Admin"}):l===C.MANAGER?e.jsx("span",{className:"text-primary",children:"Owner"}):e.jsx("span",{className:"text-primary",children:"User"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-4",children:[e.jsx("h3",{className:"font-medium text-md mb-3",children:"Quick Stats"}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Total posts:"," ",e.jsx("span",{className:"text-primary",children:m?.length||0})]}),e.jsxs("p",{className:"text-sm lg:text-lg ",children:["Pinned:"," ",e.jsx("span",{className:"text-primary",children:m?.filter(g=>g.isPinned).length||0})]})]}),e.jsx("div",{className:"flex justify-center",children:i&&e.jsxs(y,{type:"primary",className:"w-9/10",onClick:z,children:[e.jsx("span",{className:"mr-5",children:"New post"}),e.jsx(Z,{className:"w-8 h-8"})]})})]})]}),i&&e.jsx("div",{className:"md:hidden fixed bg-primary-light rounded-full border border-light top-33 right-6 z-20",children:e.jsx(y,{type:"primary",variant:"icon",size:"medium",className:"text-primary",onClick:z,"aria-label":"Add new post",children:e.jsx(Z,{})})}),x&&e.jsx(de,{post:d,onSubmit:_,onCancel:B,onDelete:$,title:d?"Edit Post":"New Post"}),f&&e.jsx(CommentsModal,{isOpen:f,onClose:L,comments:v?.[d?.id]||[],postId:d?.id,onCreateComment:M,onDeleteComment:A,loading:t})]})}export{Pe as default};
