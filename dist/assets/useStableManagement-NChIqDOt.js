import{r as o}from"./vendor-router-BURTDQSf.js";import{e as D,E as p,D as i,b as M}from"./index-Uki67T6Z.js";const x=r=>{const[m,S]=o.useState([]),[y,v]=o.useState([]),[d,a]=o.useState(!0),[b,n]=o.useState(null),[g,u]=o.useState("fetch"),[R,w]=o.useState([]),{stableRefreshKey:q}=D(),h=M(d,g),s=o.useCallback(async()=>{if(r){a(!0),u("fetch");try{const e=await p.getUsersByStableId(r),t=Array.isArray(e)?e.map(c=>({id:c.userStableId,userId:c.userId,firstName:c.firstName,lastName:c.lastName,role:c.role,profilePicture:c.profilePicture})):[];S(t);const l=await i.getStableRequests(r);v(l.received||[]);const f=await i.getStableInvites(r);w(Array.isArray(f)?f:[]),n(null)}catch(e){n(e.message||"Failed to load stable data")}finally{a(!1)}}},[r]),F=async e=>{a(!0),u("update");try{return await i.rejectStableJoinRequest({userId:e,stableId:r}),await s(),!0}catch(t){return n(t.message||"Failed to reject request"),a(!1),!1}},I=async e=>{a(!0),u("update");try{return await i.cancelStableInvite({userId:e,stableId:r}),await s(),!0}catch(t){return n(t.message||"Failed to cancel invitation"),a(!1),!1}},A=async(e,t)=>{a(!0),u("update");try{return await p.updateUserStableRole(e,t),await s(),!0}catch(l){return n(l.message||"Failed to update member role"),a(!1),!1}},E=async e=>{a(!0),u("update");try{const t={userId:e,stableId:r};return await i.acceptStableJoinRequest(t),await s(),!0}catch(t){return console.error("Error accepting join request:",t),n(t.message||"Failed to approve request"),a(!1),!1}},j=async e=>{a(!0),u("delete");try{return await p.removeUserFromStable(e),await s(),!0}catch(t){return n(t.message||"Failed to remove member"),a(!1),!1}};return o.useEffect(()=>{s()},[s,q]),{members:m,receivedRequests:y,sentInvites:R,loading:d,error:b,loadingState:h,approveRequest:E,updateMemberRole:A,rejectRequest:F,cancelInvitation:I,removeUserFromStable:j,refreshData:s}};export{x as u};
